---
title: "Analyses in Perceiving through the Grapevine: A Network Approach to Reputations (Revision 1)"
author: "Cory K. Costello & Sanjay Srivastava"
date: "last knitted: `r Sys.time()`"
output:
    html_document:
      toc: true
      toc_float: true
      code_folding: show
      df_print: paged
---
# Data & Libraries
Here I'll read in the data and load the libraries I'll use, including the `ReputationModelR` package I created for these analyses.
```{r setup, message = FALSE, warning = FALSE}
set.seed(42)
knitr::opts_chunk$set(message = FALSE, warning = FALSE, cache = TRUE, cache.extra = knitr::rand_seed)
# Make sure necessary packages are installed
if("rio" %in% installed.packages()[,1] == FALSE){install.packages("rio")}
if("magrittr" %in% installed.packages()[,1] == FALSE){install.packages("tidyverse")}
if("ReputationModelR" %in% installed.packages()[,1] == FALSE){devtools::install_github("Coryc3133/ReputationModelR")}
if("lme4" %in% installed.packages()[,1] == FALSE){install.packages("lme4")}
if("lmerTest" %in% installed.packages()[,1] == FALSE){install.packages("lmerTest")}
if("broom.mixed" %in% installed.packages()[,1] == FALSE){install.packages("broom.mixed")}
if("kableExtra" %in% installed.packages()[,1] == FALSE){install.packages("kableExtra")}
library(rio)
library(tidyverse)
library(ReputationModelR)
library(lme4)
library(lmerTest)
library(kableExtra)
study1 <- import("Data/rep_s1_4ms.csv") %>% 
  mutate(study = "study 1")
study2 <- import("Data/rep_s2_4ms.csv") %>% 
  # missing condition are "", but need to be NA
  mutate(condition = ifelse(condition == "", NA, condition),
         study = "study 2")
item_pos <- import("Data/rep_BigSix_Evaluativeness.csv")

```


## Reshape Study 1 Data for Profile Analyses

```{r study1_reshape_profiles}
study1_profiles <- 
  study1 %>% 
  select(sess_id, contains("bfi")) %>% 
  gather(var, rating, -sess_id) %>%
  separate(var, c("perceiver", "target", "item"), 
           extra = "merge") %>%
  filter(target == "A" | target == "C") %>% 
  mutate(triad_id = 
           case_when(target == "A" ~ "ACD",
                     target == "C" ~ "CAB"),
         rating_type = 
           case_when(perceiver == target ~ "self",
                     perceiver == "B" ~ "p2",
                     perceiver == "D" ~ "p2",
                     TRUE ~ "p1")) %>%
  select(sess_id, triad_id, item, 
         rating_type, rating) %>% 
  spread(rating_type, rating) %>% 
  # center ratings
  mutate(p1_uncent = p1,
         p1 = p1 - mean(p1, na.rm = TRUE),
         p2_uncent = p2,
         p2 = p2 - mean(p2, na.rm = TRUE),
         self_uncent =  self,
         self = self - mean(self, na.rm = TRUE)) %>% 
  # calculate normative and distinctive profiles
  group_by(item) %>% 
  mutate(self_norm = mean(self, na.rm = TRUE),
         self_dist = self - self_norm,
         p1_norm = mean(p1, na.rm = TRUE),
         p1_dist = p1 - p1_norm)
```

## Reshape Study 2 Data for Profile Analyses

```{r study2_reshape_profiles}
study2_profiles <- 
  study2 %>% 
  select(sess_id, contains("bfi")) %>% 
  gather(var, rating, -sess_id) %>%
  separate(var, c("perceiver", "target", "item"), 
           extra = "merge") %>%
  filter(target == "A" | target == "C") %>% 
  mutate(triad_id = 
           case_when(target == "A" ~ "ACD",
                     target == "C" ~ "CAB"),
         rating_type = 
           case_when(perceiver == target ~ "self",
                     perceiver == "B" ~ "p2",
                     perceiver == "D" ~ "p2",
                     TRUE ~ "p1")) %>%
  select(sess_id, triad_id, item, 
         rating_type, rating) %>% 
  spread(rating_type, rating) %>% 
  # center ratings
  mutate(p1_uncent = p1,
         p1 = p1 - mean(p1, na.rm = TRUE),
         p2_uncent = p2,
         p2 = p2 - mean(p2, na.rm = TRUE),
         self_uncent =  self,
         self = self - mean(self, na.rm = TRUE)) %>% 
  # calculate normative and distinctive profiles
  group_by(item) %>% 
  mutate(self_norm = mean(self, na.rm = TRUE),
         self_dist = self - self_norm,
         p1_norm = mean(p1, na.rm = TRUE),
         p1_dist = p1 - p1_norm)
```

## ICCs and profile for Item Positivity
### ICC
```{r icc_pos}
item_pos %>% 
  t() %>% 
  psych::ICC()
```

### Calculating Item Positivity Profile
```{r pos_profile}
item_pos_prof <- item_pos %>% 
  gather(item, rating, -subj) %>% 
  # mean center it
  mutate(rating_cent = rating - mean(rating, na.rm = TRUE)) %>% 
  group_by(item) %>% 
  summarize(pos = mean(rating_cent, na.rm = TRUE),
            pos_uncent = mean(rating, na.rm = TRUE)) %>% 
  mutate(item = str_to_lower(item),
         item = str_replace_all(item, "bfie_", "bfi_"))
```

#### Joining to other data

```{r join_pos}
# study 1
study1_profiles <- study1_profiles %>%  
  left_join(item_pos_prof)

# study 2
study2_profiles <- study2_profiles %>%  
  left_join(item_pos_prof)
```

##  Calculate Scale Scores
Here I'll score the BFI into domain scores and the IRI into its subscales. I'll also produce coefficeint alphas and basic descriptives. 

I'm going to use the `scoreItems()` function from the `psych` package. This both reverse scores items and calculates scale scores. It also provide some information about the scores.

### Study 1 Data: Score Big Six Domains
* agreeableness     = 2, 7, 12R, 17R, 22R, 27, 32, 37R, 42R, 47R, 52, 57
* conscientiousness = 3R, 8R, 13, 18, 23R, 28R, 33, 38, 43, 48R, 53, 58R
* hp                = HP45r HP46r HP47r HP48r HP49r HP50 HP51 HP52
* neuroticism       = 4R, 9R, 14, 19, 24R, 29R, 34, 39, 44R, 49R, 54, 59
* extraversion      = 1, 6, 11R, 16R, 21, 26R, 31R, 36R, 41, 46, 51R, 56
* openness          = 5R, 10, 15, 20, 25R, 30R, 35, 40, 45R, 50R, 55R, 60

For now, first make the key:
```{r make_big6_keys}
# Make keys
big6_keys <- list(
                 agreeableness = c("bfi_2", "bfi_7", "-bfi_12", "-bfi_17", 
                                   "-bfi_22", "bfi_27", "bfi_32", "-bfi_37", 
                                   "-bfi_42", "-bfi_47", "bfi_52", "bfi_57"),
                 conscientiousness = c("-bfi_3", "-bfi_8", "bfi_13", "bfi_18", 
                                       "-bfi_23", "-bfi_28", "bfi_33", "bfi_38", 
                                       "bfi_43", "-bfi_48", "bfi_53", "-bfi_58"),
                 hp = c("-bfi_hp45", "-bfi_hp46", "-bfi_hp47", "-bfi_hp48", 
                            "-bfi_hp49", "bfi_hp50", "bfi_hp51", "bfi_hp52"),
                 neuroticism = c("-bfi_4", "-bfi_9", "bfi_14", "bfi_19", 
                                 "-bfi_24", "-bfi_29", "bfi_34", "bfi_39",
                                 "-bfi_44", "-bfi_49", "bfi_54", "bfi_59"),
                 extraversion = c("bfi_1", "bfi_6", "-bfi_11", "-bfi_16", 
                                  "bfi_21", "-bfi_26", "-bfi_31", "-bfi_36", 
                                  "bfi_41", "bfi_46", "-bfi_51", "bfi_56"),
                 openness = c("-bfi_5", "bfi_10", "bfi_15", "bfi_20", 
                              "-bfi_25", "-bfi_30", "bfi_35", "bfi_40", 
                              "-bfi_45", "-bfi_50", "-bfi_55", "bfi_60"))
```

Next, I'll score the Big Six. I'll turn the data into long format to make things a little easier, since it's the same scoring used for all of the Big Six ratings.
```{r score_big6}
# Lengthen Data
study1_big6_long <- 
study1 %>% 
  select(sess_id, contains("bfi")) %>% 
  gather(variable, rating, -sess_id) %>% 
  separate(variable, 
           c("perceiver", "target", "item"), 
           extra = "merge") %>% 
  spread(item, rating)

# Score long data and bind the scores to
# the end of the long data, then widen it back out
# and call it study1, replacing the raw data
study1 <- 
  psych::scoreItems(big6_keys, 
                    items = study1_big6_long, 
                    impute = "none") %>% 
  .[["scores"]] %>% 
  cbind(study1_big6_long, .) %>% 
  gather(variable, rating, -(1:3)) %>% 
  unite(variable, perceiver, target, variable) %>% 
  spread(variable, rating) %>% 
  select(sess_id,
         ends_with("agreeableness"),
         ends_with("conscientiousness"),
         ends_with("hp"),
         ends_with("neuroticism"),
         ends_with("extraversion"),
         ends_with("openness")) %>% 
  right_join(study1)
```

Finally, I'll get the coefficient alphas for each subscale. 

```{r alphas_big6}
library(kableExtra)

study1_big6_long %>% 
  mutate(rating_type = case_when(perceiver == target ~ "Self",
                               perceiver == "A" & target == "C" |
                                 perceiver == "C" & target == "A" ~ "P1",
                               perceiver == "B" & target == "C" |
                                 perceiver == "D" & target == "A" ~ "P2")) %>% 
  split(.$rating_type) %>% 
  map_df(~ psych::scoreItems(big6_keys,
                          items = .,
                          impute = "none") %>% pluck("alpha")) %>% 
  mutate(domain = names(big6_keys),
         domain = ifelse(domain == "hp", "honesty-propriety", domain)) %>% 
  gather(report, alpha, -domain) %>%
  mutate(report = fct_relevel(report, 
                              "Self",
                              "P1",
                              "P2")) %>% 
  select(report, domain, alpha) %>% 
  arrange(report) %>% 
  knitr::kable(digits = c(NA, NA, 2),
               caption = "Coefficient Alphas for Big Six Ratings Study 1",
               format = "html", escape = F) %>%
  kable_styling("striped", full_width = F)
  
```
### Study 1 Data: Calculate scale scores: IRI

* Empathic Concern = q2_emp, q4_empr, q9_emp, q14_empr, q18_empr, q20_emp, q22_emp

* Fantasy Scale = q1_fs, q5_fs, q7_fsr, q12_fsr, q16_fs, q23_fs, q26_fs

* Personal Distress = q6_pd, q10_pd, q13_pdr, q17_pd, q19_pdr, q24_pd, q27_pd

* Perspective Taking = q3_ptr, q8_pt, q11_pt, q15_ptr, q21_pt, q25_pt, q28_pt


Using the `scoreItems()` function from the psych package again. Then, Ill save out and cbind the scores to the data, and produce a table for the alphas. 

First make the key:
```{r make_keys_iri}
iri_keys <- list(
  iri_empathic = c("q2_emp", "-q4_emp", "q9_emp", "-q14_emp", "-q18_emp", "q20_emp", "q22_emp"),
  iri_fantasy = c("q1_fs", "q5_fs", "-q7_fs", "-q12_fs", "q16_fs", "q23_fs", "q26_fs"),
  iri_distress = c("q6_pd", "q10_pd", "-q13_pd", "q17_pd", "-q19_pd", "q24_pd", "q27_pd"),
  iri_perspective = c("-q3_pt", "q8_pt", "q11_pt", "-q15_pt", "q21_pt", "q25_pt", "q28_pt")
)
```

Next, I'll score the IRI. I'll turn the data into long format like above with the Big Six.
```{r score_iri}
# Lengthen Data
study1_iri_long <- 
study1 %>% 
  select(sess_id, starts_with("B_q"), starts_with("D_q")) %>% 
  gather(variable, rating, -sess_id) %>% 
  separate(variable, 
           c("perceiver", "item"), 
           extra = "merge") %>% 
  spread(item, rating)

# Score long data and bind the scores to
# the end of the long data, then widen it back out
# and call it study1, replacing the raw data
study1 <- 
  psych::scoreItems(iri_keys, 
                    items = study1_iri_long, 
                    impute = "none") %>% 
  .[["scores"]] %>% 
  cbind(study1_iri_long, .) %>% 
  gather(variable, rating, -(1:2)) %>% 
  unite(variable, perceiver, variable) %>% 
  spread(variable, rating) %>% 
  select(sess_id, contains("iri")) %>% 
  right_join(study1)
```

Finally, I'll get the coefficient alphas for each subscale. 

```{r alphas_iri}
library(kableExtra)

 psych::scoreItems(iri_keys, 
                    items = study1_iri_long, 
                    impute = "none") %>% 
  .[["alpha"]] %>% 
   as_tibble() %>% 
   gather(subscale, alpha) %>% 
   mutate(subscale =
            case_when(subscale == "iri_empathic" ~ "empathic concern",
                      subscale == "iri_fantasy" ~ "fantasy",
                      subscale == "iri_distress" ~ "distress tolerance",
                      subscale == "iri_perspective" ~ "perspective taking")) %>% 
  knitr::kable(digits = c(NA, 2),
               caption = "Coefficient Alphas for Perspective Taking Study 1",
               format = "html", escape = F) %>%
  kable_styling("striped", full_width = F)
  
```

### Study 2 Data: Score Big Six Domains
Same scoring & keys as Study 2. Basically just the dataframes are different, and the rest is the same.
```{r score_big6_s2}
# Lengthen Data
study2_big6_long <- 
study2 %>% 
  select(sess_id, contains("bfi")) %>% 
  gather(variable, rating, -sess_id) %>% 
  separate(variable, 
           c("perceiver", "target", "item"), 
           extra = "merge") %>% 
  spread(item, rating)

# Score long data and bind the scores to
# the end of the long data, then widen it back out
# and call it study2, replacing the raw data
study2 <- 
  psych::scoreItems(big6_keys, 
                    items = study2_big6_long, 
                    impute = "none") %>% 
  .[["scores"]] %>% 
  cbind(study2_big6_long, .) %>% 
  gather(variable, rating, -(1:3)) %>% 
  unite(variable, perceiver, target, variable) %>% 
  spread(variable, rating) %>% 
  select(sess_id,
         ends_with("agreeableness"),
         ends_with("conscientiousness"),
         ends_with("hp"),
         ends_with("neuroticism"),
         ends_with("extraversion"),
         ends_with("openness")) %>% 
  right_join(study2)
```

Finally, I'll get the coefficient alphas for each subscale. 

```{r alphas_big6_s2}
library(kableExtra)

study2_big6_long %>% 
  mutate(rating_type = case_when(perceiver == target ~ "Self",
                               perceiver == "A" & target == "C" |
                                 perceiver == "C" & target == "A" ~ "P1",
                               perceiver == "B" & target == "C" |
                                 perceiver == "D" & target == "A" ~ "P2")) %>% 
  split(.$rating_type) %>% 
  map_df(~ psych::scoreItems(big6_keys,
                          items = .,
                          impute = "none") %>% pluck("alpha")) %>% 
  mutate(domain = names(big6_keys),
         domain = ifelse(domain == "hp", "honesty-propriety", domain)) %>% 
  gather(report, alpha, -domain) %>%
  mutate(report = fct_relevel(report, 
                              "Self",
                              "P1",
                              "P2")) %>% 
  select(report, domain, alpha) %>% 
  arrange(report) %>% 
  knitr::kable(digits = c(NA, NA, 2),
               caption = "Coefficient Alphas for Big Six Ratings Study 2",
               format = "html", escape = F) %>%
  kable_styling("striped", full_width = F)
  
```

### Study 2 Data: Calculate scale scores: IRI
Same keys as before

Next, I'll score the IRI. I'll turn the data into long format like above with the Big Six.
```{r score_iri_s2}
# Lengthen Data
study2_iri_long <- 
study2 %>% 
  select(sess_id, starts_with("B_q"), starts_with("D_q")) %>% 
  gather(variable, rating, -sess_id) %>% 
  separate(variable, 
           c("perceiver", "item"), 
           extra = "merge") %>% 
  spread(item, rating)

# Score long data and bind the scores to
# the end of the long data, then widen it back out
# and call it study2, replacing the raw data
study2 <- 
  psych::scoreItems(iri_keys, 
                    items = study2_iri_long, 
                    impute = "none") %>% 
  .[["scores"]] %>% 
  cbind(study2_iri_long, .) %>% 
  gather(variable, rating, -(1:2)) %>% 
  unite(variable, perceiver, variable) %>% 
  spread(variable, rating) %>% 
  select(sess_id, contains("iri")) %>% 
  right_join(study2)
```

Finally, I'll get the coefficient alphas for each subscale. 

```{r alphas_iri_s2}
psych::scoreItems(iri_keys, 
                    items = study2_iri_long, 
                    impute = "none") %>% 
  .[["alpha"]] %>% 
   as_tibble() %>% 
   gather(subscale, alpha) %>% 
   mutate(subscale =
            case_when(subscale == "iri_empathic" ~ "empathic concern",
                      subscale == "iri_fantasy" ~ "fantasy",
                      subscale == "iri_distress" ~ "distress tolerance",
                      subscale == "iri_perspective" ~ "perspective taking")) %>% 
  knitr::kable(digits = c(NA, 2),
               caption = "Coefficient Alphas for Perspective Taking Study 2",
               format = "html", escape = F) %>%
  kable_styling("striped", full_width = F)
  
```

# Hearsay SAM with Integrated (combined Study 1 & 2 data)
## functions for tables
```{r fixed_fx_tbl_funs, cache = FALSE}
lm_beta_lmer <- function(mod) {
   b <- fixef(mod)[-1]
   sd.x <- apply(getME(mod,"X")[,-1],2,sd)
   sd.y <- sd(getME(mod,"y"))
   b*sd.x/sd.y
}

fixed_coefs_tbl <- function(model){
  model %>% 
  broom.mixed::tidy(effects = "fixed", conf.int = TRUE) %>% 
  transmute(
    term = term,
    est = estimate,
    ci_ll = conf.low,
    ci_ul = conf.high,
    se = std.error,
    t = statistic,
    df = df, 
    p = p.value,
  ) %>% 
  mutate(std_est = c(0, lm_beta_lmer(model)),
         p = ifelse(p > .001, round(p, 3), "<.001"),
         component = case_when(
           term == "(Intercept)" ~ "intercept",
           term == "self_norm" ~ "Normative Accuracy",
           term == "self_dist" ~ "Distinctive Accuracy",
           term == "p1_norm" ~ "Normative Consensus",
           term == "p1_dist" ~ "Distinctive Consensus",
           term == "pos" ~ "Positivity Bias", 
           term == "distancep2" ~ "Distance (P1 vs. P2)", 
           term == "self_norm:distancep2" ~ "Distance X Normative Accuracy",
           term == "self_dist:distancep2" ~ "Distance X Distinctive Accuracy",
           term == "pos:distancep2" ~ "Distance X Positivity Bias", 
           # extraversion moderators
           term == "t_ext_cent" ~ "Target Extraversion",
           term == "p1_norm:t_ext_cent" ~ "Target Extraversion X Normative Consensus",
           term == "p1_dist:t_ext_cent" ~ "Target Extraversion X Distinctive Consensus",
           term == "pos:t_ext_cent" ~ "Target Extraversion X Positivity Bias",
           term == "t_ext_cent" ~ "Target Extraversion",
           term == "self_norm:t_ext_cent" ~ "Target Extraversion X Normative Accuracy",
           term == "self_dist:t_ext_cent" ~ "Target Extraversion X Distinctive Accuracy",
           term == "pos:t_ext_cent" ~ "Target Extraversion X Positivity Bias",
           term == "p1_ext_cent" ~ "P1 Extraversion",
           term == "p1_norm:p1_ext_cent" ~ "P1 Extraversion X Normative Consensus",
           term == "p1_dist:p1_ext_cent" ~ "P1 Extraversion X Distinctive Consensus",
           term == "pos:p1_ext_cent" ~ "P1 Extraversion X Positivity Bias",
           term == "p1_ext_cent" ~ "P1 Extraversion",
           term == "self_norm:p1_ext_cent" ~ "P1 Extraversion X Normative Accuracy",
           term == "self_dist:p1_ext_cent" ~ "P1 Extraversion X Distinctive Accuracy",
           term == "pos:p1_ext_cent" ~ "P1 Extraversion X Positivity Bias",
           term == "p2_ext_cent" ~ "P2 Extraversion",
           term == "p1_norm:p2_ext_cent" ~ "P2 Extraversion X Normative Consensus",
           term == "p1_dist:p2_ext_cent" ~ "P2 Extraversion X Distinctive Consensus",
           term == "pos:p2_ext_cent" ~ "P2 Extraversion X Positivity Bias",
           term == "p2_ext_cent" ~ "P2 Extraversion",
           term == "self_norm:p2_ext_cent" ~ "P2 Extraversion X Normative Accuracy",
           term == "self_dist:p2_ext_cent" ~ "P2 Extraversion X Distinctive Accuracy",
           term == "pos:p2_ext_cent" ~ "P2 Extraversion X Positivity Bias",
           # empathy moderators
           term == "distress_cent" ~ "P2 Distress",
           term == "p1_norm:distress_cent" ~ "P2 Distress X Normative Consensus",
           term == "p1_dist:distress_cent" ~ "P2 Distress X Distinctive Consensus",
           term == "pos:distress_cent" ~ "P2 Distress X Positivity Bias",
           term == "distress_cent" ~ "P2 Distress",
           term == "self_norm:distress_cent" ~ "P2 Distress X Normative Accuracy",
           term == "self_dist:distress_cent" ~ "P2 Distress X Distinctive Accuracy",
           term == "pos:distress_cent" ~ "P2 Distress X Positivity Bias",
           term == "fantasy_cent" ~ "P2 Fantasy",
           term == "p1_norm:fantasy_cent" ~ "P2 Fantasy X Normative Consensus",
           term == "p1_dist:fantasy_cent" ~ "P2 Fantasy X Distinctive Consensus",
           term == "pos:fantasy_cent" ~ "P2 Fantasy X Positivity Bias",
           term == "fantasy_cent" ~ "P2 Fantasy",
           term == "self_norm:fantasy_cent" ~ "P2 Fantasy X Normative Accuracy",
           term == "self_dist:fantasy_cent" ~ "P2 Fantasy X Distinctive Accuracy",
           term == "pos:fantasy_cent" ~ "P2 Fantasy X Positivity Bias",
           term == "empathic_cent" ~ "P2 Empathic Concern",
           term == "p1_norm:empathic_cent" ~ "P2 Empathic Concern X Normative Consensus",
           term == "p1_dist:empathic_cent" ~ "P2 Empathic Concern X Distinctive Consensus",
           term == "pos:empathic_cent" ~ "P2 Empathic Concern X Positivity Bias",
           term == "empathic_cent" ~ "P2 Empathic Concern",
           term == "self_norm:empathic_cent" ~ "P2 Empathic Concern X Normative Accuracy",
           term == "self_dist:empathic_cent" ~ "P2 Empathic Concern X Distinctive Accuracy",
           term == "pos:empathic_cent" ~ "P2 Empathic Concern X Positivity Bias",
           term == "perspective_cent" ~ "P2 Perspective Taking",
           term == "p1_norm:perspective_cent" ~ "P2 Perspective Taking X Normative Consensus",
           term == "p1_dist:perspective_cent" ~ "P2 Perspective Taking X Distinctive Consensus",
           term == "pos:perspective_cent" ~ "P2 Perspective Taking X Positivity Bias",
           term == "perspective_cent" ~ "P2 Perspective Taking",
           term == "self_norm:perspective_cent" ~ "P2 Perspective Taking X Normative Accuracy",
           term == "self_dist:perspective_cent" ~ "P2 Perspective Taking X Distinctive Accuracy",
           term == "pos:perspective_cent" ~ "P2 Perspective Taking X Positivity Bias"),
         term = case_when(
           term == "(Intercept)" ~ "$\\gamma_{000}$",
           term == "self_norm" ~ "$\\gamma_{100}$",
           term == "self_dist" ~ "$\\gamma_{200}$",
           term == "p1_norm" ~ "$\\gamma_{100}$",
           term == "p1_dist" ~ "$\\gamma_{200}$",
           term == "pos" ~ "$\\gamma_{300}$", 
           term == "distancep2" ~ "$\\gamma_{010}$", 
           term == "self_norm:distancep2" ~ "$\\gamma_{110}$",
           term == "self_dist:distancep2" ~ "$\\gamma_{210}$",
           term == "pos:distancep2" ~ "$\\gamma_{310}$", 
                      # extraversion moderators
           term == "t_ext_cent" ~ "$\\gamma_{010}$",
           term == "p1_norm:t_ext_cent" ~ "$\\gamma_{110}$",
           term == "p1_dist:t_ext_cent" ~ "$\\gamma_{210}$",
           term == "pos:t_ext_cent" ~ "$\\gamma_{310}$",
           term == "t_ext_cent" ~ "$\\gamma_{010}$",
           term == "self_norm:t_ext_cent" ~ "$\\gamma_{110}$",
           term == "self_dist:t_ext_cent" ~ "$\\gamma_{210}$",
           term == "pos:t_ext_cent" ~ "$\\gamma_{310}$",
           term == "p1_ext_cent" ~ "$\\gamma_{010}$",
           term == "p1_norm:p1_ext_cent" ~ "$\\gamma_{110}$",
           term == "p1_dist:p1_ext_cent" ~ "$\\gamma_{210}$",
           term == "pos:p1_ext_cent" ~ "$\\gamma_{310}$",
           term == "p1_ext_cent" ~ "$\\gamma_{010}$",
           term == "self_norm:p1_ext_cent" ~ "$\\gamma_{110}$",
           term == "self_dist:p1_ext_cent" ~ "$\\gamma_{210}$",
           term == "pos:p1_ext_cent" ~ "$\\gamma_{310}$",
           term == "p2_ext_cent" ~ "$\\gamma_{010}$",
           term == "p1_norm:p2_ext_cent" ~ "$\\gamma_{110}$",
           term == "p1_dist:p2_ext_cent" ~ "$\\gamma_{210}$",
           term == "pos:p2_ext_cent" ~ "$\\gamma_{310}$",
           term == "p2_ext_cent" ~ "$\\gamma_{010}$",
           term == "self_norm:p2_ext_cent" ~ "$\\gamma_{110}$",
           term == "self_dist:p2_ext_cent" ~ "$\\gamma_{210}$",
           term == "pos:p2_ext_cent" ~ "$\\gamma_{310}$",
           # empathy moderators
           term == "distress_cent" ~ "$\\gamma_{010}$",
           term == "p1_norm:distress_cent" ~ "$\\gamma_{110}$",
           term == "p1_dist:distress_cent" ~ "$\\gamma_{210}$",
           term == "pos:distress_cent" ~ "$\\gamma_{310}$",
           term == "distress_cent" ~ "$\\gamma_{010}$",
           term == "self_norm:distress_cent" ~ "$\\gamma_{110}$",
           term == "self_dist:distress_cent" ~ "$\\gamma_{210}$",
           term == "pos:distress_cent" ~ "$\\gamma_{310}$",
           term == "fantasy_cent" ~ "$\\gamma_{010}$",
           term == "p1_norm:fantasy_cent" ~ "$\\gamma_{110}$",
           term == "p1_dist:fantasy_cent" ~ "$\\gamma_{210}$",
           term == "pos:fantasy_cent" ~ "$\\gamma_{310}$",
           term == "fantasy_cent" ~ "$\\gamma_{010}$",
           term == "self_norm:fantasy_cent" ~ "$\\gamma_{110}$",
           term == "self_dist:fantasy_cent" ~ "$\\gamma_{210}$",
           term == "pos:fantasy_cent" ~ "$\\gamma_{310}$",
           term == "empathic_cent" ~ "$\\gamma_{010}$",
           term == "p1_norm:empathic_cent" ~ "$\\gamma_{110}$",
           term == "p1_dist:empathic_cent" ~ "$\\gamma_{210}$",
           term == "pos:empathic_cent" ~ "$\\gamma_{310}$",
           term == "empathic_cent" ~ "$\\gamma_{010}$",
           term == "self_norm:empathic_cent" ~ "$\\gamma_{110}$",
           term == "self_dist:empathic_cent" ~ "$\\gamma_{210}$",
           term == "pos:empathic_cent" ~ "$\\gamma_{310}$",
           term == "perspective_cent" ~ "$\\gamma_{010}$",
           term == "p1_norm:perspective_cent" ~ "$\\gamma_{110}$",
           term == "p1_dist:perspective_cent" ~ "$\\gamma_{210}$",
           term == "pos:perspective_cent" ~ "$\\gamma_{310}$",
           term == "perspective_cent" ~ "$\\gamma_{010}$",
           term == "self_norm:perspective_cent" ~ "$\\gamma_{110}$",
           term == "self_dist:perspective_cent" ~ "$\\gamma_{210}$",
           term == "pos:perspective_cent" ~ "$\\gamma_{310}$"
           ))%>% 
  select(term, component, est, ci_ll, ci_ul, se, t, df, p, std_est) %>% 
  knitr::kable(style = "html",
               digits = c(NA, NA, 2, 2, 2, 2, 2, 2, 3, 2)) %>% 
  kableExtra::kable_styling("striped", full_width = F)
}

```

```{r Ran_fx_tbl_funs, cache = FALSE}

random_coefs_tbl <- function(model){
  model %>% 
  broom.mixed::tidy(effects = "ran_pars", scales = "vcov") %>% 
  transmute(
    source = group,
    term = term,
    est = estimate) %>% 
  separate(term, c("type", "term"), extra = "merge") %>% 
  mutate(type = str_replace_all(type, c(
           "var" = "variance",
           "cov" = "covariance")),
         source = str_replace_all(source, c(
           "triad_id" = "triad",
           "sess_id" = "group")),
         term = str_replace_all(term, c(
           #"(Intercept)" = "intercept",
           "self_norm" = "Normative Accuracy",
           "self_dist" = "Distinctive Accuracy",
           "p1_norm" = "Normative Consensus",
           "p1_dist" = "Distinctive Consensus",
           "pos" = "Positivity Bias", 
           "self_norm:distancep2" = "Distance X Normative Accuracy",
           "self_dist:distancep2" = "Distance X Distinctive Accuracy",
           "pos:distancep2" = "Distance X Positivity Bias", 
           # extraversion moderators
           "t_ext_cent" = "Target Extraversion",
           "p1_norm:t_ext_cent" = "Target Extraversion X Normative Consensus",
           "p1_dist:t_ext_cent" = "Target Extraversion X Distinctive Consensus",
           "pos:t_ext_cent" = "Target Extraversion X Positivity Bias",
           "t_ext_cent" = "Target Extraversion",
           "self_norm:t_ext_cent" = "Target Extraversion X Normative Accuracy",
           "self_dist:t_ext_cent" = "Target Extraversion X Distinctive Accuracy",
           "pos:t_ext_cent" = "Target Extraversion X Positivity Bias",
           "p1_ext_cent" = "P1 Extraversion",
           "p1_norm:p1_ext_cent" = "P1 Extraversion X Normative Consensus",
           "p1_dist:p1_ext_cent" = "P1 Extraversion X Distinctive Consensus",
           "pos:p1_ext_cent" = "P1 Extraversion X Positivity Bias",
           "p1_ext_cent" = "P1 Extraversion",
           "self_norm:p1_ext_cent" = "P1 Extraversion X Normative Accuracy",
           "self_dist:p1_ext_cent" = "P1 Extraversion X Distinctive Accuracy",
           "pos:p1_ext_cent" = "P1 Extraversion X Positivity Bias",
           "p2_ext_cent" = "P2 Extraversion",
           "p1_norm:p2_ext_cent" = "P2 Extraversion X Normative Consensus",
           "p1_dist:p2_ext_cent" = "P2 Extraversion X Distinctive Consensus",
           "pos:p2_ext_cent" = "P2 Extraversion X Positivity Bias",
           "p2_ext_cent" = "P2 Extraversion",
           "self_norm:p2_ext_cent" = "P2 Extraversion X Normative Accuracy",
           "self_dist:p2_ext_cent" = "P2 Extraversion X Distinctive Accuracy",
           "pos:p2_ext_cent" = "P2 Extraversion X Positivity Bias",
           # empathy moderators
           "distress_cent" = "P2 Distress",
           "p1_norm:distress_cent" = "P2 Distress X Normative Consensus",
           "p1_dist:distress_cent" = "P2 Distress X Distinctive Consensus",
           "pos:distress_cent" = "P2 Distress X Positivity Bias",
           "distress_cent" = "P2 Distress",
           "self_norm:distress_cent" = "P2 Distress X Normative Accuracy",
           "self_dist:distress_cent" = "P2 Distress X Distinctive Accuracy",
           "pos:distress_cent" = "P2 Distress X Positivity Bias",
           "fantasy_cent" = "P2 Fantasy",
           "p1_norm:fantasy_cent" = "P2 Fantasy X Normative Consensus",
           "p1_dist:fantasy_cent" = "P2 Fantasy X Distinctive Consensus",
           "pos:fantasy_cent" = "P2 Fantasy X Positivity Bias",
           "fantasy_cent" = "P2 Fantasy",
           "self_norm:fantasy_cent" = "P2 Fantasy X Normative Accuracy",
           "self_dist:fantasy_cent" = "P2 Fantasy X Distinctive Accuracy",
           "pos:fantasy_cent" = "P2 Fantasy X Positivity Bias",
           "empathic_cent" = "P2 Empathic Concern",
           "p1_norm:empathic_cent" = "P2 Empathic Concern X Normative Consensus",
           "p1_dist:empathic_cent" = "P2 Empathic Concern X Distinctive Consensus",
           "pos:empathic_cent" = "P2 Empathic Concern X Positivity Bias",
           "empathic_cent" = "P2 Empathic Concern",
           "self_norm:empathic_cent" = "P2 Empathic Concern X Normative Accuracy",
           "self_dist:empathic_cent" = "P2 Empathic Concern X Distinctive Accuracy",
           "pos:empathic_cent" = "P2 Empathic Concern X Positivity Bias",
           "perspective_cent" = "P2 Perspective Taking",
           "p1_norm:perspective_cent" = "P2 Perspective Taking X Normative Consensus",
           "p1_dist:perspective_cent" = "P2 Perspective Taking X Distinctive Consensus",
           "pos:perspective_cent" = "P2 Perspective Taking X Positivity Bias",
           "perspective_cent" = "P2 Perspective Taking",
           "self_norm:perspective_cent" = "P2 Perspective Taking X Normative Accuracy",
           "self_dist:perspective_cent" = "P2 Perspective Taking X Distinctive Accuracy",
           "pos:perspective_cent" = "P2 Perspective Taking X Positivity Bias",
           "\\." = ", ",
           "distancep2" = "distance (p1 vs. p2)",
           "\\:" = " X "))) %>% 
  knitr::kable(style = "html",
               digits = c(NA, NA, NA, 2)) %>% 
  kableExtra::kable_styling("striped", full_width = F)
}
```


## Combining Study 1 and 2 for integrated analyses

```{r combine_data}
# create study column
study1_profiles$study <- "study1"  
study2_profiles$study <- "study2"  

# join studies
integrated_profiles <- rbind(study1_profiles,  
                             study2_profiles)
```

## Item-level Means for Each Rater (T(T), P1(T), P2(T)) and Desirability

```{r item_lvl_means}

# item text
full_bigsix_text <- 
  import("data/rep_bigsix_item_text.csv") %>% 
  mutate(item = stringr::str_to_lower(item),
         item = stringr::str_replace_all(item, "bfii", "bfi"))

integrated_profiles %>% 
  group_by(item) %>% 
  summarize(self = mean(self_uncent, na.rm = TRUE),
         p1 = mean(p1_uncent, na.rm = TRUE),
         p2 = mean(p2_uncent, na.rm = TRUE),
         positivity = mean(pos_uncent, na.rm = TRUE)) %>% 
  left_join(full_bigsix_text) %>% 
  mutate(order = str_extract(item, "\\d*$"),
         order = as.numeric(order),
         # put hp at the end
         order = ifelse(str_detect(item, "hp"), order + 100, order)) %>% 
  arrange(order) %>% 
  select(item, text, self, p1, p2, positivity) %>% 
  knitr::kable(style = "html",
               digits = c(NA, NA, 2, 2, 2, 2),
               caption = "Table of (Uncentered) Mean Ratings for Big Six Items by Rater Type") %>% 
  kableExtra::kable_styling("striped", full_width = F)
```


## P1-P2 Agreement 

### Level 1 Equation:
$P2_{itg} = \pi_{0tg} +  \pi_{2tg}NormativeP1_{i} + \pi_{1tg}DistinctiveP1_{it} + \pi_{3tg}Positivity_{i} + \epsilon_{itg}$

### Level 2 Equation: 
$\pi_{0tg} = \beta_{00g} + r_{0tg}$   
$\pi_{1tg} = \beta_{10g} + r_{1tg}$   
$\pi_{2tg} = \beta_{20g} + r_{2tg}$   
$\pi_{3tg} = \beta_{30g} + r_{3tg}$

### Level 3 Equation:
$\beta_{00g} = \gamma_{000} + u_{00g}$   
$\beta_{10g} = \gamma_{100} + u_{10g}$   
$\beta_{20g} = \gamma_{200} + u_{20g}$  
$\beta_{30g} = \gamma_{300} + u_{30g}$  

*i* = item; *t* = triad; *g* = group

### Does study matter?
```{r integrated_p1p2_consensus_sam_study}
integrated_consensus_sam_studyref <- lmer(p2 ~ p1_norm + p1_dist + pos +
                         (1 + p1_norm + p1_dist + pos | study/sess_id/triad_id),
                       data = integrated_profiles)

integrated_consensus_sam <- lmer(p2 ~ p1_norm + p1_dist + pos +
                         (1 + p1_norm + p1_dist + pos | sess_id/triad_id),
                       data = integrated_profiles)
```

```{r study_rfx_comp_consensus}

study_comp_consensus_sam <- anova(integrated_consensus_sam_studyref,
                                  integrated_consensus_sam) %>% 
  as_tibble()

study_comp_consensus_sam
```

```{r study_rfx_comp_consensus2}

study_comp_consensus_sam %>% 
  mutate(delt_aic = AIC - lag(AIC) ,
         delt_bic = BIC - lag(BIC)) %>% 
  slice(-1) 
```

```{r integrated_p1p2_consensus_sam_summary}
summary(integrated_consensus_sam)
```

```{r integrated_p1p2_consensus_sam_tbl, cache = FALSE}
integrated_consensus_sam %>% 
  fixed_coefs_tbl()
```

```{r integrated_p1p2_consensus_sam_rfx_tbl, cache = FALSE}
integrated_consensus_sam %>% 
  random_coefs_tbl()
```

## Self-P1 & Self-P2 in same model

### Level 1 Equation:
$P_{itg} = \pi_{0tg} +  \pi_{2tg}NormativeSelf_{i} + \pi_{1tg}DistinctiveSelf_{it} + \pi_{3tg}Positivity_{i} + \epsilon_{itg}$

### Level 2 Equation: 
$\pi_{0tg} = \beta_{00g} + \beta_{01g}Distance_{tg} + r_{0tg}$   
$\pi_{1tg} = \beta_{10g} + \beta_{11g}Distance_{tg} + r_{1tg}$   
$\pi_{2tg} = \beta_{20g} + \beta_{21g}Distance_{tg} + r_{2tg}$   
$\pi_{3tg} = \beta_{30g} + \beta_{31g}Distance_{tg} + r_{2tg}$    

### Level 3 Equation:
$\beta_{00g} = \gamma_{000} + u_{00g}$   
$\beta_{01g} = \gamma_{010} + u_{01g}$   
$\beta_{10g} = \gamma_{100} + u_{10g}$   
$\beta_{11g} = \gamma_{110} + u_{11g}$   
$\beta_{20g} = \gamma_{200} + u_{20g}$   
$\beta_{21g} = \gamma_{210} + u_{21g}$   
$\beta_{30g} = \gamma_{300} + u_{30g}$   
$\beta_{31g} = \gamma_{310} + u_{31g}$

```{r prep_integrated_}
integrated_profiles2 <- integrated_profiles %>% 
  select(sess_id, triad_id, study, item, self_norm, self_dist, pos, p1, p2) %>% 
  gather(distance, rating, -(sess_id:pos))

```


```{r integrated_accuracy_sam}
integrated_accuracy_sam_combined_studyref <- lmer(rating ~ self_norm + self_dist + pos + distance +
                               distance:self_norm + distance:self_dist + distance:pos +
                               (1 + self_norm + self_dist + distance +
                                  distance:self_norm + distance:self_dist + distance:pos | 
                                  study/sess_id/triad_id),
                             data = integrated_profiles2)

integrated_accuracy_sam_combined <- lmer(rating ~ self_norm + self_dist + pos + distance +
                               distance:self_norm + distance:self_dist + distance:pos +
                               (1 + self_norm + self_dist + distance +
                                  distance:self_norm + distance:self_dist + distance:pos | 
                                  sess_id/triad_id),
                             data = integrated_profiles2)


```

```{r study_rfx_comp_accuracy1}
study_comp_accuracy_sam <- anova(integrated_accuracy_sam_combined_studyref,
                                 integrated_accuracy_sam_combined) %>% 
  as_tibble()
```


```{r study_rfx_comp_accuracy2}
study_comp_accuracy_sam %>% 
  mutate(delt_aic = AIC - lag(AIC) ,
         delt_bic = BIC - lag(BIC)) %>% 
  slice(-1) 
```

```{r integrated_SAM_summary}
summary(integrated_accuracy_sam_combined)
```

```{r integrated_accuracy_sam_tbl, cache = FALSE}
integrated_accuracy_sam_combined %>% 
  fixed_coefs_tbl()
```

```{r integrated_accuracy_sam_rfx_tbl, cache = FALSE}
integrated_accuracy_sam_combined %>% 
  random_coefs_tbl()
```

### Simple Slope for p2

```{r integrated_simple_accuracy_p2}

integrated_accuracy_simple_sam_p2 <- lmer(p2 ~ self_norm + self_dist + pos +
                               (1 + self_norm + self_dist + pos | 
                                  sess_id/triad_id),
                             data = integrated_profiles)
summary(integrated_accuracy_simple_sam_p2)
```

```{r integrated_simple_accuracy_p2_tbl, cache = FALSE}
integrated_accuracy_simple_sam_p2 %>% 
  fixed_coefs_tbl()
```

```{r integrated_simple_accuracy_p2_rfx_tbl, cache = FALSE}
integrated_accuracy_simple_sam_p2 %>% 
  random_coefs_tbl()
```

## Individual Difference Moderators

### Extraversion Moderating Hearsay Consensus
#### Target Extraversion moderating Hearsay consensus
$P2_{itg} = \pi_{0tg} +  \pi_{2tg}NormativeP1_{i} + \pi_{1tg}DistinctiveP1_{it} + \pi_{3tg}Positivity_{i} + \epsilon_{itg}$

#### Level 2 Equation: 
$\pi_{0tg} = \beta_{00g} + \beta_{01g}targetExtraversion_{tg} + r_{0tg}$   
$\pi_{1tg} = \beta_{10g} + \beta_{11g}targetExtraversion_{tg} + r_{1tg}$   
$\pi_{2tg} = \beta_{20g} + \beta_{21g}targetExtraversion_{tg} + r_{2tg}$   
$\pi_{3tg} = \beta_{30g} + \beta_{31g}targetExtraversion_{tg} + r_{2tg}$    

#### Level 3 Equation:
$\beta_{00g} = \gamma_{000} + u_{00g}$   
$\beta_{01g} = \gamma_{010} + u_{01g}$   
$\beta_{10g} = \gamma_{100} + u_{10g}$   
$\beta_{11g} = \gamma_{110} + u_{11g}$   
$\beta_{20g} = \gamma_{200} + u_{20g}$   
$\beta_{21g} = \gamma_{210} + u_{21g}$   
$\beta_{30g} = \gamma_{300} + u_{30g}$   
$\beta_{31g} = \gamma_{310} + u_{31g}$

```{r integrated_consensus_x_target_ext_sam}
integrated_consensus_sam_t_ext <- lmer(p2 ~ p1_norm + p1_dist + pos + t_ext_cent +
                               t_ext_cent:p1_norm + t_ext_cent:p1_dist + t_ext_cent:pos +
                               (1 + p1_norm + p1_dist + t_ext_cent +
                                  t_ext_cent:p1_norm + t_ext_cent:p1_dist + t_ext_cent:pos | 
                                  sess_id/triad_id),
                             data = integrated_profiles)
summary(integrated_consensus_sam_t_ext)
```

```{r integrated_consensus_sam_t_ext_tbl, cache = FALSE}
integrated_consensus_sam_t_ext %>% 
  fixed_coefs_tbl()
```

```{r integrated_consensus_sam_t_ext_rfx_tbl, cache = FALSE}
integrated_consensus_sam_t_ext %>% 
  random_coefs_tbl()
```
#### P1 Extraversion moderating Hearsay Consensus
$P2_{itg} = \pi_{0tg} +  \pi_{2tg}NormativeP1_{i} + \pi_{1tg}DistinctiveP1_{it} + \pi_{3tg}Positivity_{i} + \epsilon_{itg}$

##### Level 2 Equation: 
$\pi_{0tg} = \beta_{00g} + \beta_{01g}P1Extraversion_{tg} + r_{0tg}$   
$\pi_{1tg} = \beta_{10g} + \beta_{11g}P1Extraversion_{tg} + r_{1tg}$   
$\pi_{2tg} = \beta_{20g} + \beta_{21g}P1Extraversion_{tg} + r_{2tg}$   
$\pi_{3tg} = \beta_{30g} + \beta_{31g}P1Extraversion_{tg} + r_{2tg}$    

##### Level 3 Equation:
$\beta_{00g} = \gamma_{000} + u_{00g}$   
$\beta_{01g} = \gamma_{010} + u_{01g}$   
$\beta_{10g} = \gamma_{100} + u_{10g}$   
$\beta_{11g} = \gamma_{110} + u_{11g}$   
$\beta_{20g} = \gamma_{200} + u_{20g}$   
$\beta_{21g} = \gamma_{210} + u_{21g}$   
$\beta_{30g} = \gamma_{300} + u_{30g}$   
$\beta_{31g} = \gamma_{310} + u_{31g}$

```{r integrated_consensus_x_p1_ext_sam}
integrated_consensus_sam_p1_ext <- lmer(p2 ~ p1_norm + p1_dist + pos + p1_ext_cent +
                               p1_ext_cent:p1_norm + p1_ext_cent:p1_dist + p1_ext_cent:pos +
                               (1 + p1_norm + p1_dist + p1_ext_cent +
                                  p1_ext_cent:p1_norm + p1_ext_cent:p1_dist + p1_ext_cent:pos | 
                                  sess_id/triad_id),
                             data = integrated_profiles)
summary(integrated_consensus_sam_p1_ext)
```

```{r integrated_consensus_sam_p1_ext_tbl, cache = FALSE}
integrated_consensus_sam_p1_ext %>% 
  fixed_coefs_tbl()
```

```{r integrated_consensus_sam_p1_ext_rfx_tbl, cache = FALSE}
integrated_consensus_sam_p1_ext %>% 
  random_coefs_tbl()
```

#### P2 Extraversion moderating Hearsay Consensus
$P2_{itg} = \pi_{0tg} +  \pi_{2tg}NormativeP1_{i} + \pi_{1tg}DistinctiveP1_{it} + \pi_{3tg}Positivity_{i} + \epsilon_{itg}$

##### Level 2 Equation: 
$\pi_{0tg} = \beta_{00g} + \beta_{01g}P2Extraversion_{tg} + r_{0tg}$   
$\pi_{1tg} = \beta_{10g} + \beta_{11g}P2Extraversion_{tg} + r_{1tg}$   
$\pi_{2tg} = \beta_{20g} + \beta_{21g}P2Extraversion_{tg} + r_{2tg}$   
$\pi_{3tg} = \beta_{30g} + \beta_{31g}P2Extraversion_{tg} + r_{2tg}$    

##### Level 3 Equation:
$\beta_{00g} = \gamma_{000} + u_{00g}$   
$\beta_{01g} = \gamma_{010} + u_{01g}$   
$\beta_{10g} = \gamma_{100} + u_{10g}$   
$\beta_{11g} = \gamma_{110} + u_{11g}$   
$\beta_{20g} = \gamma_{200} + u_{20g}$   
$\beta_{21g} = \gamma_{210} + u_{21g}$   
$\beta_{30g} = \gamma_{300} + u_{30g}$   
$\beta_{31g} = \gamma_{310} + u_{31g}$

```{r integrated_consensus_x_p2_ext_sam}
integrated_consensus_sam_p2_ext <- lmer(p2 ~ p1_norm + p1_dist + pos + p2_ext_cent +
                               p2_ext_cent:p1_norm + p2_ext_cent:p1_dist + p2_ext_cent:pos +
                               (1 + p1_norm + p1_dist + p2_ext_cent +
                                  p2_ext_cent:p1_norm + p2_ext_cent:p1_dist + p2_ext_cent:pos | 
                                  sess_id/triad_id),
                             data = integrated_profiles)
summary(integrated_consensus_sam_p2_ext)
```

```{r integrated_consensus_sam_p2_ext_tbl, cache = FALSE}
integrated_consensus_sam_p2_ext %>% 
  fixed_coefs_tbl()
```

```{r integrated_consensus_sam_p2_ext_rfx_tbl, cache = FALSE}
integrated_consensus_sam_p2_ext %>% 
  random_coefs_tbl()
```


### Empathy Moderating Consensus
#### Distress moderating Hearsay consensus
$P2_{itg} = \pi_{0tg} +  \pi_{2tg}NormativeP1_{i} + \pi_{1tg}DistinctiveP1_{it} + \pi_{3tg}Positivity_{i} + \epsilon_{itg}$

##### Level 2 Equation: 
$\pi_{0tg} = \beta_{00g} + \beta_{01g}Distress_{tg} + r_{0tg}$   
$\pi_{1tg} = \beta_{10g} + \beta_{11g}Distress_{tg} + r_{1tg}$   
$\pi_{2tg} = \beta_{20g} + \beta_{21g}Distress_{tg} + r_{2tg}$   
$\pi_{3tg} = \beta_{30g} + \beta_{31g}Distress_{tg} + r_{2tg}$    

##### Level 3 Equation:
$\beta_{00g} = \gamma_{000} + u_{00g}$   
$\beta_{01g} = \gamma_{010} + u_{01g}$   
$\beta_{10g} = \gamma_{100} + u_{10g}$   
$\beta_{11g} = \gamma_{110} + u_{11g}$   
$\beta_{20g} = \gamma_{200} + u_{20g}$   
$\beta_{21g} = \gamma_{210} + u_{21g}$   
$\beta_{30g} = \gamma_{300} + u_{30g}$   
$\beta_{31g} = \gamma_{310} + u_{31g}$

```{r integrated_consensus_x_distress}
integrated_consensus_sam_distress <- lmer(p2 ~ p1_norm + p1_dist + pos + distress_cent +
                               distress_cent:p1_norm + distress_cent:p1_dist + 
                                 distress_cent:pos +
                               (1 + p1_norm + p1_dist + distress_cent +
                                  distress_cent:p1_norm + 
                                  distress_cent:p1_dist + distress_cent:pos | 
                                  sess_id/triad_id),
                             data = integrated_profiles)
summary(integrated_consensus_sam_distress)
```

```{r integrated_consensus_sam_distress_tbl, cache = FALSE}
integrated_consensus_sam_distress %>% 
  fixed_coefs_tbl()
```

```{r integrated_consensus_sam_distress_rfx_tbl, cache = FALSE}
integrated_consensus_sam_distress %>% 
  random_coefs_tbl()
```

#### Empathic Concern moderating Hearsay consensus
$P2_{itg} = \pi_{0tg} +  \pi_{2tg}NormativeP1_{i} + \pi_{1tg}DistinctiveP1_{it} + \pi_{3tg}Positivity_{i} + \epsilon_{itg}$

##### Level 2 Equation: 
$\pi_{0tg} = \beta_{00g} + \beta_{01g}EmpathicConcern_{tg} + r_{0tg}$   
$\pi_{1tg} = \beta_{10g} + \beta_{11g}EmpathicConcern_{tg} + r_{1tg}$   
$\pi_{2tg} = \beta_{20g} + \beta_{21g}EmpathicConcern_{tg} + r_{2tg}$   
$\pi_{3tg} = \beta_{30g} + \beta_{31g}EmpathicConcern_{tg} + r_{2tg}$    

##### Level 3 Equation:
$\beta_{00g} = \gamma_{000} + u_{00g}$   
$\beta_{01g} = \gamma_{010} + u_{01g}$   
$\beta_{10g} = \gamma_{100} + u_{10g}$   
$\beta_{11g} = \gamma_{110} + u_{11g}$   
$\beta_{20g} = \gamma_{200} + u_{20g}$   
$\beta_{21g} = \gamma_{210} + u_{21g}$   
$\beta_{30g} = \gamma_{300} + u_{30g}$   
$\beta_{31g} = \gamma_{310} + u_{31g}$

```{r integrated_consensus_x_empathic}
integrated_consensus_sam_empathic <- lmer(p2 ~ p1_norm + p1_dist + pos + empathic_cent +
                               empathic_cent:p1_norm + 
                                 empathic_cent:p1_dist + empathic_cent:pos +
                               (1 + p1_norm + p1_dist + empathic_cent +
                                  empathic_cent:p1_norm + 
                                  empathic_cent:p1_dist + empathic_cent:pos | 
                                  sess_id/triad_id),
                             data = integrated_profiles)
summary(integrated_consensus_sam_empathic)
```

```{r integrated_consensus_sam_empathic_tbl, cache = FALSE}
integrated_consensus_sam_empathic %>% 
  fixed_coefs_tbl()
```

```{r integrated_consensus_sam_empathic_rfx_tbl, cache = FALSE}
integrated_consensus_sam_empathic %>% 
  random_coefs_tbl()
```

#### Fantasy moderating Hearsay consensus
$P2_{itg} = \pi_{0tg} +  \pi_{2tg}NormativeP1_{i} + \pi_{1tg}DistinctiveP1_{it} + \pi_{3tg}Positivity_{i} + \epsilon_{itg}$

##### Level 2 Equation: 
$\pi_{0tg} = \beta_{00g} + \beta_{01g}Fantasy_{tg} + r_{0tg}$   
$\pi_{1tg} = \beta_{10g} + \beta_{11g}Fantasy_{tg} + r_{1tg}$   
$\pi_{2tg} = \beta_{20g} + \beta_{21g}Fantasy_{tg} + r_{2tg}$   
$\pi_{3tg} = \beta_{30g} + \beta_{31g}Fantasy_{tg} + r_{2tg}$    

##### Level 3 Equation:
$\beta_{00g} = \gamma_{000} + u_{00g}$   
$\beta_{01g} = \gamma_{010} + u_{01g}$   
$\beta_{10g} = \gamma_{100} + u_{10g}$   
$\beta_{11g} = \gamma_{110} + u_{11g}$   
$\beta_{20g} = \gamma_{200} + u_{20g}$   
$\beta_{21g} = \gamma_{210} + u_{21g}$   
$\beta_{30g} = \gamma_{300} + u_{30g}$   
$\beta_{31g} = \gamma_{310} + u_{31g}$

```{r integrated_consensus_x_fantasy}
integrated_consensus_sam_fantasy <- lmer(p2 ~ p1_norm + p1_dist + pos + fantasy_cent +
                               fantasy_cent:p1_norm + fantasy_cent:p1_dist + 
                                 fantasy_cent:pos +
                               (1 + p1_norm + p1_dist + fantasy_cent +
                                  fantasy_cent:p1_norm + fantasy_cent:p1_dist + 
                                  fantasy_cent:pos | 
                                  sess_id/triad_id),
                             data = integrated_profiles)
summary(integrated_consensus_sam_fantasy)
```

```{r integrated_consensus_sam_fantasy_tbl, cache = FALSE}
integrated_consensus_sam_fantasy %>% 
  fixed_coefs_tbl()
```

```{r integrated_consensus_sam_fantasy_rfx_tbl, cache = FALSE}
integrated_consensus_sam_fantasy %>% 
  random_coefs_tbl()
```

#### Perspective Taking moderating Hearsay consensus
$P2_{itg} = \pi_{0tg} +  \pi_{2tg}NormativeP1_{i} + \pi_{1tg}DistinctiveP1_{it} + \pi_{3tg}Positivity_{i} + \epsilon_{itg}$

#### Level 2 Equation: 
$\pi_{0tg} = \beta_{00g} + \beta_{01g}PerspectiveTaking_{tg} + r_{0tg}$   
$\pi_{1tg} = \beta_{10g} + \beta_{11g}PerspectiveTaking_{tg} + r_{1tg}$   
$\pi_{2tg} = \beta_{20g} + \beta_{21g}PerspectiveTaking_{tg} + r_{2tg}$   
$\pi_{3tg} = \beta_{30g} + \beta_{31g}PerspectiveTaking_{tg} + r_{2tg}$    

#### Level 3 Equation:
$\beta_{00g} = \gamma_{000} + u_{00g}$   
$\beta_{01g} = \gamma_{010} + u_{01g}$   
$\beta_{10g} = \gamma_{100} + u_{10g}$   
$\beta_{11g} = \gamma_{110} + u_{11g}$   
$\beta_{20g} = \gamma_{200} + u_{20g}$   
$\beta_{21g} = \gamma_{210} + u_{21g}$   
$\beta_{30g} = \gamma_{300} + u_{30g}$   
$\beta_{31g} = \gamma_{310} + u_{31g}$

```{r integrated_consensus_x_perspective}
integrated_consensus_sam_perspective <- lmer(p2 ~ p1_norm + p1_dist + pos + perspective_cent +
                               perspective_cent:p1_norm + 
                                 perspective_cent:p1_dist + perspective_cent:pos +
                               (1 + p1_norm + p1_dist + perspective_cent +
                                  perspective_cent:p1_norm + 
                                  perspective_cent:p1_dist + perspective_cent:pos | 
                                  sess_id/triad_id),
                             data = integrated_profiles)
summary(integrated_consensus_sam_perspective)
```

```{r integrated_consensus_sam_perspective_tbl, cache = FALSE}
integrated_consensus_sam_perspective %>% 
  fixed_coefs_tbl()
```

```{r integrated_consensus_sam_perspective_rfx_tbl, cache = FALSE}
integrated_consensus_sam_perspective %>% 
  random_coefs_tbl()
```

### Extraversion Moderating Hearsay Accuracy
#### Target Extraversion moderating Hearsay Accuracy
$P2_{itg} = \pi_{0tg} +  \pi_{2tg}NormativeSelf_{i} + \pi_{1tg}DistinctiveSelf_{it} + \pi_{3tg}Positivity_{i} + \epsilon_{itg}$

##### Level 2 Equation: 
$\pi_{0tg} = \beta_{00g} + \beta_{01g}targetExtraversion_{tg} + r_{0tg}$   
$\pi_{1tg} = \beta_{10g} + \beta_{11g}targetExtraversion_{tg} + r_{1tg}$   
$\pi_{2tg} = \beta_{20g} + \beta_{21g}targetExtraversion_{tg} + r_{2tg}$   
$\pi_{3tg} = \beta_{30g} + \beta_{31g}targetExtraversion_{tg} + r_{2tg}$    

##### Level 3 Equation:
$\beta_{00g} = \gamma_{000} + u_{00g}$   
$\beta_{01g} = \gamma_{010} + u_{01g}$   
$\beta_{10g} = \gamma_{100} + u_{10g}$   
$\beta_{11g} = \gamma_{110} + u_{11g}$   
$\beta_{20g} = \gamma_{200} + u_{20g}$   
$\beta_{21g} = \gamma_{210} + u_{21g}$   
$\beta_{30g} = \gamma_{300} + u_{30g}$   
$\beta_{31g} = \gamma_{310} + u_{31g}$

```{r integrated_accuracy_x_target_ext_sam}
integrated_accuracy_sam_t_ext <- lmer(p2 ~ self_norm + self_dist + pos + t_ext_cent +
                               t_ext_cent:self_norm + t_ext_cent:self_dist + t_ext_cent:pos +
                               (1 + self_norm + self_dist + t_ext_cent +
                                  t_ext_cent:self_norm + t_ext_cent:self_dist + t_ext_cent:pos | 
                                  sess_id/triad_id),
                             data = integrated_profiles)
summary(integrated_accuracy_sam_t_ext)
```

```{r integrated_accuracy_sam_t_ext_tbl, cache = FALSE}
integrated_accuracy_sam_t_ext %>% 
  fixed_coefs_tbl()
```

```{r integrated_accuracy_sam_t_ext_rfx_tbl, cache = FALSE}
integrated_accuracy_sam_t_ext %>% 
  random_coefs_tbl()
```

#### P1 Extraversion moderating Hearsay Accuracy
$P2_{itg} = \pi_{0tg} +  \pi_{2tg}NormativeSelf_{i} + \pi_{1tg}DistinctiveSelf_{it} + \pi_{3tg}Positivity_{i} + \epsilon_{itg}$

#### Level 2 Equation: 
$\pi_{0tg} = \beta_{00g} + \beta_{01g}P1Extraversion_{tg} + r_{0tg}$   
$\pi_{1tg} = \beta_{10g} + \beta_{11g}P1Extraversion_{tg} + r_{1tg}$   
$\pi_{2tg} = \beta_{20g} + \beta_{21g}P1Extraversion_{tg} + r_{2tg}$   
$\pi_{3tg} = \beta_{30g} + \beta_{31g}P1Extraversion_{tg} + r_{2tg}$    

#### Level 3 Equation:
$\beta_{00g} = \gamma_{000} + u_{00g}$   
$\beta_{01g} = \gamma_{010} + u_{01g}$   
$\beta_{10g} = \gamma_{100} + u_{10g}$   
$\beta_{11g} = \gamma_{110} + u_{11g}$   
$\beta_{20g} = \gamma_{200} + u_{20g}$   
$\beta_{21g} = \gamma_{210} + u_{21g}$   
$\beta_{30g} = \gamma_{300} + u_{30g}$   
$\beta_{31g} = \gamma_{310} + u_{31g}$

```{r integrated_accuracy_x_p1_ext_sam}
integrated_accuracy_sam_p1_ext <- lmer(p2 ~ self_norm + self_dist + pos + p1_ext_cent +
                               p1_ext_cent:self_norm + p1_ext_cent:self_dist + p1_ext_cent:pos +
                               (1 + self_norm + self_dist + p1_ext_cent +
                                  p1_ext_cent:self_norm + p1_ext_cent:self_dist + p1_ext_cent:pos | 
                                  sess_id/triad_id),
                             data = integrated_profiles)
summary(integrated_accuracy_sam_p1_ext)
```

```{r integrated_accuracy_sam_p1_ext_tbl, cache = FALSE}
integrated_accuracy_sam_p1_ext %>% 
  fixed_coefs_tbl()
```

```{r integrated_accuracy_sam_p1_ext_rfx_tbl, cache = FALSE}
integrated_accuracy_sam_p1_ext %>% 
  random_coefs_tbl()
```

#### P2 Extraversion moderating Hearsay Accuracy
$P2_{itg} = \pi_{0tg} +  \pi_{2tg}NormativeSelf_{i} + \pi_{1tg}DistinctiveSelf_{it} + \pi_{3tg}Positivity_{i} + \epsilon_{itg}$

#### Level 2 Equation: 
$\pi_{0tg} = \beta_{00g} + \beta_{01g}P2Extraversion_{tg} + r_{0tg}$   
$\pi_{1tg} = \beta_{10g} + \beta_{11g}P2Extraversion_{tg} + r_{1tg}$   
$\pi_{2tg} = \beta_{20g} + \beta_{21g}P2Extraversion_{tg} + r_{2tg}$   
$\pi_{3tg} = \beta_{30g} + \beta_{31g}P2Extraversion_{tg} + r_{2tg}$    

#### Level 3 Equation:
$\beta_{00g} = \gamma_{000} + u_{00g}$   
$\beta_{01g} = \gamma_{010} + u_{01g}$   
$\beta_{10g} = \gamma_{100} + u_{10g}$   
$\beta_{11g} = \gamma_{110} + u_{11g}$   
$\beta_{20g} = \gamma_{200} + u_{20g}$   
$\beta_{21g} = \gamma_{210} + u_{21g}$   
$\beta_{30g} = \gamma_{300} + u_{30g}$   
$\beta_{31g} = \gamma_{310} + u_{31g}$

```{r integrated_accuracy_x_p2_ext_sam}
integrated_accuracy_sam_p2_ext <- lmer(p2 ~ self_norm + self_dist + pos + p2_ext_cent +
                               p2_ext_cent:self_norm + p2_ext_cent:self_dist + p2_ext_cent:pos +
                               (1 + self_norm + self_dist + p2_ext_cent +
                                  p2_ext_cent:self_norm + 
                                  p2_ext_cent:self_dist + p2_ext_cent:pos | 
                                  sess_id/triad_id),
                             data = integrated_profiles)
summary(integrated_accuracy_sam_p2_ext)
```

```{r integrated_accuracy_sam_p2_ext_tbl, cache = FALSE}
integrated_accuracy_sam_p2_ext %>% 
  fixed_coefs_tbl()
```

```{r integrated_accuracy_sam_p2_ext_rfx_tbl, cache = FALSE}
integrated_accuracy_sam_p2_ext %>% 
  random_coefs_tbl()
```

### Empathy Moderating Accuracy
#### Distress moderating Hearsay accuracy
$P2_{itg} = \pi_{0tg} +  \pi_{2tg}NormativeSelf_{i} + \pi_{1tg}DistinctiveSelf_{it} + \pi_{3tg}Positivity_{i} + \epsilon_{itg}$

##### Level 2 Equation: 
$\pi_{0tg} = \beta_{00g} + \beta_{01g}Distress_{tg} + r_{0tg}$   
$\pi_{1tg} = \beta_{10g} + \beta_{11g}Distress_{tg} + r_{1tg}$   
$\pi_{2tg} = \beta_{20g} + \beta_{21g}Distress_{tg} + r_{2tg}$   
$\pi_{3tg} = \beta_{30g} + \beta_{31g}Distress_{tg} + r_{2tg}$    

##### Level 3 Equation:
$\beta_{00g} = \gamma_{000} + u_{00g}$   
$\beta_{01g} = \gamma_{010} + u_{01g}$   
$\beta_{10g} = \gamma_{100} + u_{10g}$   
$\beta_{11g} = \gamma_{110} + u_{11g}$   
$\beta_{20g} = \gamma_{200} + u_{20g}$   
$\beta_{21g} = \gamma_{210} + u_{21g}$   
$\beta_{30g} = \gamma_{300} + u_{30g}$   
$\beta_{31g} = \gamma_{310} + u_{31g}$

```{r integrated_accuracy_x_distress}
integrated_accuracy_sam_distress <- lmer(p2 ~ self_norm + self_dist + pos + distress_cent +
                               distress_cent:self_norm + distress_cent:self_dist +
                                 distress_cent:pos +
                               (1 + self_norm + self_dist + distress_cent +
                                  distress_cent:self_norm + 
                                  distress_cent:self_dist + distress_cent:pos | 
                                  sess_id/triad_id),
                             data = integrated_profiles)
summary(integrated_accuracy_sam_distress)
```

```{r integrated_accuracy_sam_distress_tbl, cache = FALSE}
integrated_accuracy_sam_distress %>% 
  fixed_coefs_tbl()
```

```{r integrated_accuracy_sam_distress_rfx_tbl, cache = FALSE}
integrated_accuracy_sam_distress %>% 
  random_coefs_tbl()
```

#### Empathic Concern moderating Hearsay accuracy
$P2_{itg} = \pi_{0tg} +  \pi_{2tg}NormativeSelf_{i} + \pi_{1tg}DistinctiveSelf_{it} + \pi_{3tg}Positivity_{i} + \epsilon_{itg}$

##### Level 2 Equation: 
$\pi_{0tg} = \beta_{00g} + \beta_{01g}EmpathicConcern_{tg} + r_{0tg}$   
$\pi_{1tg} = \beta_{10g} + \beta_{11g}EmpathicConcern_{tg} + r_{1tg}$   
$\pi_{2tg} = \beta_{20g} + \beta_{21g}EmpathicConcern_{tg} + r_{2tg}$   
$\pi_{3tg} = \beta_{30g} + \beta_{31g}EmpathicConcern_{tg} + r_{2tg}$    

##### Level 3 Equation:
$\beta_{00g} = \gamma_{000} + u_{00g}$   
$\beta_{01g} = \gamma_{010} + u_{01g}$   
$\beta_{10g} = \gamma_{100} + u_{10g}$   
$\beta_{11g} = \gamma_{110} + u_{11g}$   
$\beta_{20g} = \gamma_{200} + u_{20g}$   
$\beta_{21g} = \gamma_{210} + u_{21g}$   
$\beta_{30g} = \gamma_{300} + u_{30g}$   
$\beta_{31g} = \gamma_{310} + u_{31g}$

```{r integrated_accuracy_x_empathic}
integrated_accuracy_sam_empathic <- lmer(p2 ~ self_norm + self_dist + pos + empathic_cent +
                               empathic_cent:self_norm + empathic_cent:self_dist + 
                                 empathic_cent:pos +
                               (1 + self_norm + self_dist + empathic_cent +
                                  empathic_cent:self_norm + 
                                  empathic_cent:self_dist + empathic_cent:pos | 
                                  sess_id/triad_id),
                             data = integrated_profiles)
summary(integrated_accuracy_sam_empathic)
```

```{r integrated_accuracy_sam_empathic_tbl, cache = FALSE}
integrated_accuracy_sam_empathic %>% 
  fixed_coefs_tbl()
```

```{r integrated_accuracy_sam_empathic_rfx_tbl, cache = FALSE}
integrated_accuracy_sam_empathic %>% 
  random_coefs_tbl()
```

#### Fantasy moderating Hearsay accuracy
$P2_{itg} = \pi_{0tg} +  \pi_{2tg}NormativeSelf_{i} + \pi_{1tg}DistinctiveSelf_{it} + \pi_{3tg}Positivity_{i} + \epsilon_{itg}$

##### Level 2 Equation: 
$\pi_{0tg} = \beta_{00g} + \beta_{01g}Fantasy_{tg} + r_{0tg}$   
$\pi_{1tg} = \beta_{10g} + \beta_{11g}Fantasy_{tg} + r_{1tg}$   
$\pi_{2tg} = \beta_{20g} + \beta_{21g}Fantasy_{tg} + r_{2tg}$   
$\pi_{3tg} = \beta_{30g} + \beta_{31g}Fantasy_{tg} + r_{2tg}$    

##### Level 3 Equation:
$\beta_{00g} = \gamma_{000} + u_{00g}$   
$\beta_{01g} = \gamma_{010} + u_{01g}$   
$\beta_{10g} = \gamma_{100} + u_{10g}$   
$\beta_{11g} = \gamma_{110} + u_{11g}$   
$\beta_{20g} = \gamma_{200} + u_{20g}$   
$\beta_{21g} = \gamma_{210} + u_{21g}$   
$\beta_{30g} = \gamma_{300} + u_{30g}$   
$\beta_{31g} = \gamma_{310} + u_{31g}$

```{r integrated_accuracy_x_fantasy}
integrated_accuracy_sam_fantasy <- lmer(p2 ~ self_norm + self_dist + pos + fantasy_cent +
                               fantasy_cent:self_norm +
                                 fantasy_cent:self_dist + fantasy_cent:pos +
                               (1 + self_norm + self_dist + fantasy_cent +
                                  fantasy_cent:self_norm + 
                                  fantasy_cent:self_dist + fantasy_cent:pos | 
                                  sess_id/triad_id),
                             data = integrated_profiles)
summary(integrated_accuracy_sam_fantasy)
```

```{r integrated_accuracy_sam_fantasy_tbl, cache = FALSE}
integrated_accuracy_sam_fantasy %>% 
  fixed_coefs_tbl()
```

```{r integrated_accuracy_sam_fantasy_rfx_tbl, cache = FALSE}
integrated_accuracy_sam_fantasy %>% 
  random_coefs_tbl()
```

#### Perspective Taking moderating Hearsay accuracy
$P2_{itg} = \pi_{0tg} +  \pi_{2tg}NormativeSelf_{i} + \pi_{1tg}DistinctiveSelf_{it} + \pi_{3tg}Positivity_{i} + \epsilon_{itg}$

##### Level 2 Equation: 
$\pi_{0tg} = \beta_{00g} + \beta_{01g}PerspectiveTaking_{tg} + r_{0tg}$   
$\pi_{1tg} = \beta_{10g} + \beta_{11g}PerspectiveTaking_{tg} + r_{1tg}$   
$\pi_{2tg} = \beta_{20g} + \beta_{21g}PerspectiveTaking_{tg} + r_{2tg}$   
$\pi_{3tg} = \beta_{30g} + \beta_{31g}PerspectiveTaking_{tg} + r_{2tg}$    

##### Level 3 Equation:
$\beta_{00g} = \gamma_{000} + u_{00g}$   
$\beta_{01g} = \gamma_{010} + u_{01g}$   
$\beta_{10g} = \gamma_{100} + u_{10g}$   
$\beta_{11g} = \gamma_{110} + u_{11g}$   
$\beta_{20g} = \gamma_{200} + u_{20g}$   
$\beta_{21g} = \gamma_{210} + u_{21g}$   
$\beta_{30g} = \gamma_{300} + u_{30g}$   
$\beta_{31g} = \gamma_{310} + u_{31g}$

```{r integrated_accuracy_x_perspective}
integrated_accuracy_sam_perspective <- lmer(p2 ~ self_norm + self_dist + pos + perspective_cent +
                               perspective_cent:self_norm + 
                                 perspective_cent:self_dist + perspective_cent:pos +
                               (1 + self_norm + self_dist + perspective_cent +
                                  perspective_cent:self_norm + 
                                  perspective_cent:self_dist + perspective_cent:pos | 
                                  sess_id/triad_id),
                             data = integrated_profiles)
summary(integrated_accuracy_sam_perspective)
```

```{r integrated_accuracy_sam_perspective_tbl, cache = FALSE}
integrated_accuracy_sam_perspective %>% 
  fixed_coefs_tbl()
```

```{r integrated_accuracy_sam_perspective_rfx_tbl, cache = FALSE}
integrated_accuracy_sam_perspective %>% 
  random_coefs_tbl()
```

# Domain-wise correlations
## Combine (scored) wide study 1 and study 2 dataframes 
```{r}
study1 <- study1 %>% 
  mutate(study = "study 1")
study2 <- study2 %>% 
  mutate(study = "study 2")
# combine data
integrated <- study2 %>% 
  # Remove vars exclusive Study 2
  .[, colnames(.) %in% colnames(study1)] %>% 
  rbind(study1) %>% 
  select(study, sess_id, everything()) %>% 
  arrange(study)
```

## Model Comparisons to Assess Justifiability of Pooling across Studies

### Agreeableness
```{r agree_integrated_models}
agree_integrated_noeq <- rep_auto_group_mod(integrated, 
                                        p1_reports = c("A_C_agreeableness", "C_A_agreeableness"),
                                        p2_reports = c("B_C_agreeableness", "D_A_agreeableness"),
                                        target_self = c("C_C_agreeableness", "A_A_agreeableness"),
                                        group_mod = "study",
                                        groups_eql = "none",
                                        params_eql = "none",
                                        use_labs = TRUE)

agree_integrated_alleq <- rep_auto_group_mod(integrated, 
                                        p1_reports = c("A_C_agreeableness", "C_A_agreeableness"),
                                        p2_reports = c("B_C_agreeableness", "D_A_agreeableness"),
                                        target_self = c("C_C_agreeableness", "A_A_agreeableness"),
                                        group_mod = "study",
                                        groups_eql = "all",
                                        params_eql = "all",
                                        use_labs = TRUE)

int_model_comp_agree <- anova(agree_integrated_noeq,
                              agree_integrated_alleq)
```

### Conscientiousness
```{r consc_integrated_models}
consc_integrated_noeq <- rep_auto_group_mod(integrated, 
                                        p1_reports = c("A_C_conscientiousness", "C_A_conscientiousness"),
                                        p2_reports = c("B_C_conscientiousness", "D_A_conscientiousness"),
                                        target_self = c("C_C_conscientiousness", "A_A_conscientiousness"),
                                        group_mod = "study",
                                        groups_eql = "none",
                                        params_eql = "none",
                                        use_labs = TRUE)

consc_integrated_alleq <- rep_auto_group_mod(integrated, 
                                        p1_reports = c("A_C_conscientiousness", "C_A_conscientiousness"),
                                        p2_reports = c("B_C_conscientiousness", "D_A_conscientiousness"),
                                        target_self = c("C_C_conscientiousness", "A_A_conscientiousness"),
                                        group_mod = "study",
                                        groups_eql = "all",
                                        params_eql = "all",
                                        use_labs = TRUE)
int_model_comp_consc <- anova(consc_integrated_noeq,
                              consc_integrated_alleq)
```

### Honesty-Propriety
```{r hp_integrated_models}
hp_integrated_noeq <- rep_auto_group_mod(integrated, 
                                        p1_reports = c("A_C_hp", "C_A_hp"),
                                        p2_reports = c("B_C_hp", "D_A_hp"),
                                        target_self = c("C_C_hp", "A_A_hp"),
                                        group_mod = "study",
                                        groups_eql = "none",
                                        params_eql = "none",
                                        use_labs = TRUE)

hp_integrated_alleq <- rep_auto_group_mod(integrated, 
                                        p1_reports = c("A_C_hp", "C_A_hp"),
                                        p2_reports = c("B_C_hp", "D_A_hp"),
                                        target_self = c("C_C_hp", "A_A_hp"),
                                        group_mod = "study",
                                        groups_eql = "all",
                                        params_eql = "all",
                                        use_labs = TRUE)

int_model_comp_hp <- anova(hp_integrated_noeq,
                           hp_integrated_alleq)
```

### Neuroticism
```{r neuro_integrated_models}
neuro_integrated_noeq <- rep_auto_group_mod(integrated, 
                                        p1_reports = c("A_C_neuroticism", "C_A_neuroticism"),
                                        p2_reports = c("B_C_neuroticism", "D_A_neuroticism"),
                                        target_self = c("C_C_neuroticism", "A_A_neuroticism"),
                                        group_mod = "study",
                                        groups_eql = "none",
                                        params_eql = "none",
                                        use_labs = TRUE)

neuro_integrated_alleq <- rep_auto_group_mod(integrated, 
                                        p1_reports = c("A_C_neuroticism", "C_A_neuroticism"),
                                        p2_reports = c("B_C_neuroticism", "D_A_neuroticism"),
                                        target_self = c("C_C_neuroticism", "A_A_neuroticism"),
                                        group_mod = "study",
                                        groups_eql = "all",
                                        params_eql = "all",
                                        use_labs = TRUE)

int_model_comp_neuro <- anova(neuro_integrated_noeq,
                              neuro_integrated_alleq)
```

### Extraversion
```{r extra_integrated_models}
extra_integrated_noeq <- rep_auto_group_mod(integrated, 
                                        p1_reports = c("A_C_extraversion", "C_A_extraversion"),
                                        p2_reports = c("B_C_extraversion", "D_A_extraversion"),
                                        target_self = c("C_C_extraversion", "A_A_extraversion"),
                                        group_mod = "study",
                                        groups_eql = "none",
                                        params_eql = "none",
                                        use_labs = TRUE)

extra_integrated_alleq <- rep_auto_group_mod(integrated, 
                                        p1_reports = c("A_C_extraversion", "C_A_extraversion"),
                                        p2_reports = c("B_C_extraversion", "D_A_extraversion"),
                                        target_self = c("C_C_extraversion", "A_A_extraversion"),
                                        group_mod = "study",
                                        groups_eql = "all",
                                        params_eql = "all",
                                        use_labs = TRUE)
int_model_comp_extra <- anova(extra_integrated_noeq,
                              extra_integrated_alleq)
```

### Openness
```{r open_integrated_models}
open_integrated_noeq <- rep_auto_group_mod(integrated, 
                                        p1_reports = c("A_C_openness", "C_A_openness"),
                                        p2_reports = c("B_C_openness", "D_A_openness"),
                                        target_self = c("C_C_openness", "A_A_openness"),
                                        group_mod = "study",
                                        groups_eql = "none",
                                        params_eql = "none",
                                        use_labs = TRUE)

open_integrated_alleq <- rep_auto_group_mod(integrated, 
                                        p1_reports = c("A_C_openness", "C_A_openness"),
                                        p2_reports = c("B_C_openness", "D_A_openness"),
                                        target_self = c("C_C_openness", "A_A_openness"),
                                        group_mod = "study",
                                        groups_eql = "all",
                                        params_eql = "all",
                                        use_labs = TRUE)

int_model_comp_open <- anova(open_integrated_noeq,
                             open_integrated_alleq)
```

### Table of Comparisons

```{r integrated_model_comp_tbl}
model_comp_domains <- ls()[str_detect(ls(), "int_model_comp")] %>% 
  str_split("_") %>% 
  sapply(., function(df, position){df[position]}, 4)

ls()[str_detect(ls(), "int_model_comp")] %>% 
  lapply(FUN = get) %>%
  map(mutate, delt_aic = AIC - lag(AIC) ,
         delt_bic = BIC - lag(BIC) ) %>% 
  map_df(slice, -1) %>% 
  rename(pvalue = `Pr(>Chisq)`) %>% 
  mutate(pvalue = ifelse(pvalue >= .001, 
                         str_pad(str_replace(round(pvalue, 3), "0.", "."), 4, side = "right", pad ="0"),  
                         "< .001"),
         domain = model_comp_domains,
         domain = case_when(domain == "agree" ~ "Agreeableness",
                            domain == "consc" ~ "Conscientiousness",
                            domain == "hp" ~ "Honesty-Propriety",
                            domain == "neuro" ~ "Neuroticism",
                            domain == "extra" ~ "Extraversion",
                            domain == "open" ~ "Openness"),
         domain = fct_relevel(domain,
                              "Agreeableness",
                              "Conscientiousness",
                              "Honesty-Propriety",
                              "Neuroticism",
                              "Extraversion",
                              "Openness")) %>% 
  arrange(domain) %>% 
  select(domain, `Df diff`, `Chisq diff`, pvalue, delt_aic, delt_bic) %>% 
  knitr::kable(caption = "Model Comparison Results for Integrating across Studies",
               digits = c(NA, 0, 2, 3, 2, 2),
               format = "html", escape = FALSE) %>% 
  kable_styling("striped", full_width = F)
  
```

##  Study 2 & Integrated differential hearsay consensus, accuracy, and direct accuracy

```{r int_diff_results}
# get names of models
int_model_names <- ls()[str_detect(ls(), "integrated_[:alpha:]*eq$")]

int_diff_results <- 
  int_model_names %>% 
  map(get) %>%
  map(ez_differential_group_table) %>% 
  enframe() %>% 
  mutate(name = int_model_names) %>% 
  unnest() %>% 
  separate(name, c("domain", "temp1", "temp2")) %>% 
  select(-temp1, -temp2) %>% 
  mutate(domain = case_when(domain == "agree" ~ "Agreeableness",
                            domain == "consc" ~ "Conscientiousness",
                            domain == "hp" ~ "Honesty-Propriety",
                            domain == "neuro" ~ "Neuroticism",
                            domain == "extra" ~ "Extraversion",
                            domain == "open" ~ "Openness")) %>% 
    mutate(study = case_when(
      is.na(group_label) ~ "Integrated",
      group_label == "grp1" ~ "Study 1",
      group_label == "grp2" ~ "Study 2"),
      domain = fct_relevel(domain, 
                       "Agreeableness",
                       "Conscientiousness",
                       "Honesty-Propriety",
                       "Neuroticism",
                       "Extraversion",
                       "Openness"),
      study = fct_relevel(study,
                          "Study 1",
                          "Study 2",
                          "Integrated"),
      parameter = fct_relevel(parameter,
                              "hearsay consensus",
                              "hearsay accuracy",
                              "direct accuracy")) %>% 
    select(study, parameter, domain, everything(), -group_label)
```

### Table of Study 2 & Integrated Differential Results
```{r int_diff_results_tbl}
int_diff_results %>% 
  mutate(r = round(r, 2),
         r = ifelse(str_detect(r, "\\..$"), paste0(r, "0"), 
                    ifelse(str_detect(r, "^0$"), paste0(r, ".00"), r)),
         r = cell_spec(r, "html", 
                             bold = ifelse(ci_lower > 0, TRUE, FALSE)),
         ci_lower = round(ci_lower, 2),
         ci_lower = ifelse(str_detect(ci_lower, "\\..$"), paste0(ci_lower, "0"), 
                    ifelse(str_detect(ci_lower, "^0$"), paste0(ci_lower, ".00"), ci_lower)),
         ci_lower = cell_spec(ci_lower, "html", 
                             bold = ifelse(ci_lower > 0, TRUE, FALSE)),
         ci_upper = round(ci_upper, 2),
         ci_upper = ifelse(str_detect(ci_upper, "\\..$"), paste0(ci_upper, "0"), 
                    ifelse(str_detect(ci_upper, "^0$"), paste0(ci_upper, ".00"), ci_upper)),
         ci_upper = cell_spec(ci_upper, "html",
                             bold = ifelse(pvalue == "< .001", TRUE,
                                    ifelse(as.numeric(pvalue) < .05, TRUE, FALSE))),
         pvalue = ifelse(pvalue >= .001, 
                         str_pad(str_replace(round(pvalue, 3), "0.", "."), 4, side = "right", pad ="0"),  
                         "< .001")) %>% 
  arrange(desc(study), parameter, domain) %>% 
  filter(study != "Study 1") %>% 
  select(-study) %>% 
  knitr::kable(caption = "Study 2 & Integrated Differrntial Consensus & Accuracy Results",
              format = "html", escape = F) %>% 
  kable_styling("striped", full_width = F) %>% 
  pack_rows("Integrated", 1, 18) %>% 
  pack_rows("Study 2", 19, 36)
```

Next, I'll set the theme I use in the manuscript.
```{r plot_theme}
# Custom theme for the reputation manuscript
theme_rep_manuscript <-  theme(panel.background = element_blank(),
                         panel.grid.major.x = element_line(size=.4, color="gray90"))+
  theme(axis.line.x = element_line(color="black", size = 1),
        axis.line.y = element_line(color="black", size = 1))+
  theme(axis.title = element_text(size = rel(1), color="black"), 
        axis.text = element_text(size = rel(1), color="black"))+
  theme(plot.title= element_text(size=rel(1), hjust = .5))

```

Then set up the plot data:

```{r int_diff_results_plot_data}
int_diff_plot_data <- as_tibble(cbind(domain = c("Agreeableness",
                                                 "Conscientiousness",
                                                 "Honesty-Propriety",
                                                 "Neuroticism",
                                                 "Extraversion",
                                                 "Openness"),
  # Connelly & Ones (2010) inter-rater r
  co2010_irr = c(.31, .35, NA, .32, .50, .29),
  # Connelly & Ones (2010) self-other agreement
  co2010_soa_1 = c(.09, .13, NA, .08, .22, .12),
  # Connelly & Ones (2010) self-other agreement again
  # since we'll use it for direct and hearsay accuracy
  co2010_soa_2 = c(.09, .13, NA, .08, .22, .12))) %>% 
  gather(source, r, -domain) %>% 
  mutate(parameter = 
           case_when(source == "co2010_irr" ~ "Hearsay Consensus",
                     source == "co2010_soa_1" ~ "Hearsay Accuracy",
                     source == "co2010_soa_2" ~ "Direct Accuracy"),
         source = str_replace_all(source, 
                                  "co2010_irr", 
                                  "Connelly & Ones (2010) Study 1"),
         source = str_replace_all(source, 
                                  "co2010_soa_1", 
                                  "Connelly & Ones (2010) Study 2"),
         source = str_replace_all(source, 
                                  "co2010_soa_2", 
                                  "Connelly & Ones (2010) Study 2"),
         r = as.double(r),
         # To make plotting easier, I'm going to make two
         # variables ci.lower and ci.upper (to match the structure of our estimates)
         # and I'll make them equal to the point estimate (since that is all we have for
         # uncorrected estimates).
         ci_lower = r,
         ci_upper = r) %>% 
  full_join(mutate(int_diff_results,
                   parameter = str_to_title(parameter),
                   source = study)) %>%
  select(-study) %>% 
  # Re-level to have plots in the order we want them in
  mutate(domain = fct_relevel(factor(domain),
                              "Openness",
                              "Extraversion",
                              "Neuroticism",
                              "Honesty-Propriety",
                              "Conscientiousness",
                              "Agreeableness"),
         focus = ifelse(source == "Integrated", "low", "high"),
         source = fct_relevel(source, 
                              "Connelly & Ones (2010) Study 1",
                              "Connelly & Ones (2010) Study 2",
                              "Integrated",
                              "Study 2",
                              "Study 1"))
```


Finally, this writes out thed individual plots (Figure 3, 4, and S1) to a folder called 'plots' in the current directory. I'll also make a 3-panelled plot, which contains Figures 8, 9, and S4 all in one plot for the markdown.
```{r int_making_plots4MS_and_ppt, fig.height=11, fig.width=12}
plot_names <- c(1:3)
i <- 1
for (each in unique(int_diff_plot_data$parameter)){
  i <- i + 1
  plot_name <- paste("plot", i, sep = "_")
  plot_names[i] <- plot_name
  plot_data <- filter(int_diff_plot_data, parameter == each)
  assign(plot_name, ggplot(data = plot_data, 
                 aes(x = domain, y = r, shape = source, alpha = focus)) + 
  geom_pointrange(aes(ymin = ci_lower, ymax = ci_upper),
                  position = position_dodge(width = 1),
                  size = 1) + 
  labs(title = NULL,
       x = NULL,
       y = "r") +
  theme_rep_manuscript +
  geom_hline(yintercept = 0, linetype = 2, alpha = .5) + 
    scale_y_continuous(limit=c(-0.3, .80))+
    scale_alpha_discrete(range = c(.3, 1)) +
  coord_flip()+
  guides(shape = guide_legend(reverse = TRUE),
         alpha = FALSE) +
  scale_shape_manual(values = c(16,12, 0, 3)))
  ggsave(paste0("Plots/Integrated_", print(each), ".png"), get(plot_name),
         device = "png", height = 5, width = 9.5)
  ggsave(paste0("Plots/Integrated_", print(each), "_4ppt.png"), get(plot_name),
         device = "png", height = 5, width = 9.5, scale = .80)
}

plot_names <- plot_names[str_detect(plot_names, "^plot")]
cowplot::plot_grid(get(plot_names[1]), get(plot_names[2]),
                   get(plot_names[3]), nrow = 3,
                   labels = c("Hearsay Consensus",
                              "Hearsay Accuracy",
                              "Direct Accuracy"), 
                   label_y = 1.01,
                   label_x = .06)
```

# Context Manipulation
## Status-relevant context and extraversion

First up, comparing hearsay consensus and accuracy for Extraversion in the status vs. control conditions. 
```{r status_extraversion_models}
extra_status_noeq <- rep_auto_group_mod(study2, 
                                        p1_reports = c("A_C_extraversion", "C_A_extraversion"),
                                        p2_reports = c("B_C_extraversion", "D_A_extraversion"),
                                        target_self = c("C_C_extraversion", "A_A_extraversion"),
                                        group_mod = "condition",
                                        groups_eql = "none",
                                        params_eql = "none",
                                        use_labs = TRUE)

extra_status_hceq <- rep_auto_group_mod(study2, 
                                        p1_reports = c("A_C_extraversion", "C_A_extraversion"),
                                        p2_reports = c("B_C_extraversion", "D_A_extraversion"),
                                        target_self = c("C_C_extraversion", "A_A_extraversion"),
                                        group_mod = "condition",
                                        groups_eql = 2:3,
                                        params_eql = "hc",
                                        use_labs = TRUE)

extra_status_haeq <- rep_auto_group_mod(study2, 
                                        p1_reports = c("A_C_extraversion", "C_A_extraversion"),
                                        p2_reports = c("B_C_extraversion", "D_A_extraversion"),
                                        target_self = c("C_C_extraversion", "A_A_extraversion"),
                                        group_mod = "condition",
                                        groups_eql = 2:3,
                                        params_eql = c("ha"),
                                        use_labs = TRUE)

extra_status_daeq <- rep_auto_group_mod(study2, 
                                        p1_reports = c("A_C_extraversion", "C_A_extraversion"),
                                        p2_reports = c("B_C_extraversion", "D_A_extraversion"),
                                        target_self = c("C_C_extraversion", "A_A_extraversion"),
                                        group_mod = "condition",
                                        groups_eql = 2:3,
                                        params_eql = c("da"),
                                        use_labs = TRUE)
```

### Table of Model Comparison For Extraversion across Conditions
```{r extra_status_model_comp_tbl}
extra_status_models <- c("extra_status_hceq", 
                         "extra_status_haeq", 
                         "extra_status_daeq") 
extra_status_models %>% 
  map(get) %>% 
  map(anova, extra_status_noeq) %>% 
  map(as.data.frame) %>% 
  map(mutate, delt_aic = AIC - lag(AIC) ,
         delt_bic = BIC - lag(BIC)) %>% 
  map_df(slice, -1) %>% 
  cbind(comparison = c("Hearsay Consensus Equal",
                       "Hearsay Accuracy Equal",
                       "Direct Accuracy Equal")) %>% 
  select(comparison, 5:9) %>% 
  rename(pvalue = `Pr(>Chisq)`) %>% 
  mutate(comparison = as.character(comparison),
         comparison = ifelse(comparison == "Direct Accuracy Equal", 
                             paste0(comparison, footnote_marker_alphabet(1)), comparison),
         pvalue = ifelse(pvalue >= .001, 
                         str_pad(str_replace(round(pvalue, 3), 
                                             "0.", "."), 4, 
                                 side = "right", pad ="0"),  
                         "< .001")) %>% 
  knitr::kable(caption = "Model Comparison Results for Status-Relevant Context and Extraversion",
               digits = c(NA, 2, 0, NA, 2, 2),
               format = "html", escape = FALSE) %>% 
  kable_styling("striped", full_width = F) %>% 
  footnote(general = "Each Model is Compared to the Null Model",
           alphabet = "not pre-registered")
```
### Table of Differential Agreement for Extraversion by Condition
```{r differential_extraversion_by_condition}
ez_differential_group_table(extra_status_noeq) %>%
  mutate(condition = case_when(
  group_label == "grp1" ~ "Affiliation",
  group_label == "grp2" ~ "Neutral/Control",
  group_label == "grp3" ~ "Status"
  ),
  pvalue = ifelse(pvalue >= .001, 
                         str_pad(str_replace(round(pvalue, 3), "0.", "."), 4, 
                                 side = "right", pad ="0"),  
                         "< .001")) %>% 
  select(condition, everything(), -group_label) %>% 
  knitr::kable(caption = "Differential Results for Extraversion Across Condition",
               digits = c(NA, NA, 2, 2, 2, 3),
               format = "html", escape = FALSE) %>% 
  kable_styling("striped", full_width = F) 
```

### Plot of Hearsay Consensus & Accuracy for Extraversion in the Status vs. Control Conditions (Figure 5)
```{r differential_extraversion_by_condition_plot}
extra_status_plot <- ez_differential_group_table(extra_status_noeq) %>%
  mutate(condition = case_when(group_label == "grp1" ~ "Affiliation",
  group_label == "grp2" ~ "Neutral/Control",
  group_label == "grp3" ~ "Status")) %>% 
  filter(condition != "Affiliation") %>% 
  ggplot(aes(x = parameter, y = r, shape = condition)) +
  geom_pointrange(aes(ymin = ci_lower, ymax = ci_upper), position = position_dodge(width = .5)) + 
  theme_rep_manuscript +
  geom_hline(yintercept = 0, linetype = 2, alpha = .5) + 
  scale_y_continuous(limit=c(-0.3, .95))+
  coord_flip()+
  guides(shape=guide_legend(reverse=TRUE)) +
  labs(x = NULL)
extra_status_plot
ggsave("Plots/extraXCond.png",
       extra_status_plot,
       device = "png", height = 5, width = 9.5)
```
## Affiliation-relevant context and agreeableness

Next up, comparing hearsay consensus and accuracy for Agreeableness in the affiliation vs. control conditions.

```{r affil_agree_models}
agree_affil_noeq <- rep_auto_group_mod(study2, 
                                        p1_reports = c("A_C_agreeableness", "C_A_agreeableness"),
                                        p2_reports = c("B_C_agreeableness", "D_A_agreeableness"),
                                        target_self = c("C_C_agreeableness", "A_A_agreeableness"),
                                        group_mod = "condition",
                                        groups_eql = "none",
                                        params_eql = "none",
                                        use_labs = TRUE)

agree_affil_hceq <- rep_auto_group_mod(study2, 
                                        p1_reports = c("A_C_agreeableness", "C_A_agreeableness"),
                                        p2_reports = c("B_C_agreeableness", "D_A_agreeableness"),
                                        target_self = c("C_C_agreeableness", "A_A_agreeableness"),
                                        group_mod = "condition",
                                        groups_eql = 1:2,
                                        params_eql = "hc",
                                        use_labs = TRUE)

agree_affil_haeq <- rep_auto_group_mod(study2, 
                                        p1_reports = c("A_C_agreeableness", "C_A_agreeableness"),
                                        p2_reports = c("B_C_agreeableness", "D_A_agreeableness"),
                                        target_self = c("C_C_agreeableness", "A_A_agreeableness"),
                                        group_mod = "condition",
                                        groups_eql = 1:2,
                                        params_eql = c("ha"),
                                        use_labs = TRUE)

agree_affil_daeq <- rep_auto_group_mod(study2, 
                                        p1_reports = c("A_C_agreeableness", "C_A_agreeableness"),
                                        p2_reports = c("B_C_agreeableness", "D_A_agreeableness"),
                                        target_self = c("C_C_agreeableness", "A_A_agreeableness"),
                                        group_mod = "condition",
                                        groups_eql = 1:2,
                                        params_eql = c("da"),
                                        use_labs = TRUE)
```
### Table of Model Comparison For Agreeableness across Conditions
```{r agree_affil_model_comp_tbl}
agree_affil_models <- c("agree_affil_hceq", 
                         "agree_affil_haeq", 
                         "agree_affil_daeq") 
agree_affil_models %>% 
  map(get) %>% 
  map(anova, agree_affil_noeq) %>% 
  map(as.data.frame) %>% 
  map(mutate, delt_aic = AIC - lag(AIC) ,
         delt_bic = BIC - lag(BIC)) %>% 
  map_df(slice, -1) %>% 
  cbind(comparison = c("Hearsay Consensus Equal",
                       "Hearsay Accuracy Equal",
                       "Direct Accuracy Equal")) %>% 
  select(comparison, 5:9) %>% 
  rename(pvalue = `Pr(>Chisq)`) %>% 
  mutate(comparison = as.character(comparison),
         comparison = ifelse(comparison == "Direct Accuracy Equal", 
                             paste0(comparison, footnote_marker_alphabet(1)), comparison),
         pvalue = ifelse(pvalue >= .001, 
                         str_pad(str_replace(round(pvalue, 3), 
                                             "0.", "."), 4, 
                                 side = "right", pad ="0"),  
                         "< .001")) %>% 
  knitr::kable(caption = "Model Comparison Results for Affiliation-Relevant Context and Agreeableness",
               digits = c(NA, 2, 0, NA, 2, 2),
               format = "html", escape = FALSE) %>% 
  kable_styling("striped", full_width = F) %>% 
  footnote(general = "Each Model is Compared to the Null Model",
           alphabet = "not pre-registered")
```

### Table of Differential Agreement for Agreeableness by Condition

```{r affil_agree_table}
ez_differential_group_table(agree_affil_noeq) %>%
  mutate(condition = case_when(
  group_label == "grp1" ~ "Affiliation",
  group_label == "grp2" ~ "Neutral/Control",
  group_label == "grp3" ~ "Status"
  ),
  pvalue = ifelse(pvalue >= .001, 
                         str_pad(str_replace(round(pvalue, 3), "0.", "."), 4, 
                                 side = "right", pad ="0"),  
                         "< .001")) %>% 
  select(condition, everything(), -group_label) %>% 
  knitr::kable(caption = "Differential Results for Agreeableness Across Condition",
               digits = c(NA, NA, 2, 2, 2, 3),
               format = "html", escape = FALSE) %>% 
  kable_styling("striped", full_width = F) 
```

### Plot of Hearsay Consensus & Accuracy for Agreeableness in the Status vs. Control Conditions (Figure 6)
```{r differential_agreeableness_by_condition_plot}
agree_affil_plot <- ez_differential_group_table(agree_affil_noeq) %>%
  mutate(condition = case_when(group_label == "grp1" ~ "Affiliation",
  group_label == "grp2" ~ "Neutral/Control",
  group_label == "grp3" ~ "Status"),
  condition = fct_relevel(condition, 
                                 "Neutral/Control",
                                 "Affiliation",
                                 "Status")) %>% 
  filter(condition != "Status") %>% 
  ggplot(aes(x = parameter, y = r, shape = condition)) +
  geom_pointrange(aes(ymin = ci_lower, ymax = ci_upper), position = position_dodge(width = .5)) + 
  theme_rep_manuscript +
  geom_hline(yintercept = 0, linetype = 2, alpha = .5) + 
  scale_y_continuous(limit=c(-0.3, .95))+
  coord_flip()+
  guides(shape=guide_legend(reverse=TRUE)) +
  labs(x = NULL)
agree_affil_plot
ggsave("Plots/agreeXCond.png",
       agree_affil_plot,
       device = "png", height = 5, width = 9.5)
```

# Consequences 

## Effects of reputation on leadership judgments

### Pre-registered Mediation Model: Extraversion to Leadership
This is a pre-registerd analysis looking at whether P1's perception of thr target's Extraversion influences P2's perception of the target's Extraversion, which in turn influences their perception of the target's leadership potential. It was pre-registered as hypothesis 3 on OSF.

```{r H3_path_model}
extraversion_status_med_model_h3 <-'
# Model for A-B-C triad
B_C_contextitem_goodleader ~ b*B_C_extraversion + c*A_C_extraversion
B_C_extraversion ~ a*A_C_extraversion

# Model for C-D-A triad
D_A_contextitem_goodleader ~ b*D_A_extraversion + c*C_A_extraversion
D_A_extraversion ~ a*C_A_extraversion

# variances
B_C_contextitem_goodleader ~~ v_P2_gl*B_C_contextitem_goodleader
D_A_contextitem_goodleader ~~ v_P2_gl*D_A_contextitem_goodleader
B_C_extraversion ~~ v_P2*B_C_extraversion
D_A_extraversion ~~ v_P2*D_A_extraversion
A_C_extraversion ~~ v_P1*A_C_extraversion
C_A_extraversion ~~ v_P1*C_A_extraversion

# intercepts
B_C_contextitem_goodleader ~ int_P2_gl*1
D_A_contextitem_goodleader ~ int_P2_gl*1
B_C_extraversion ~ int_P2*1
D_A_extraversion ~ int_P2*1
A_C_extraversion ~ int_P1*1
C_A_extraversion ~ int_P1*1

# indirect (mediated) effect
indirecteffect := a*b
'
fit_extraversion_status_med_model_h3 <-sem(extraversion_status_med_model_h3, 
                                            data = study2, 
                                            missing="FIML", 
                                            se="bootstrap", 
                                            fixed.x=TRUE)

summary(fit_extraversion_status_med_model_h3)
```

#### Table for Extraversion to Leadership Mediation model
```{r extra_leader_med_model_tbl}
parameterestimates(fit_extraversion_status_med_model_h3) %>%
  as.data.frame() %>% 
  filter(label == "a" |
         label == "b" |
         label == "c" |
         label == "indirecteffect") %>% 
  rename(ci_upper = ci.upper,
         ci_lower = ci.lower) %>% 
  mutate(parameter = case_when(label == "b" ~ "P2(T) Extraversion -> P2(T) Leadership",
                              label == "c" ~ "P1(T) Extraversion -> P2(T) Leadership",
                              label == "a" ~ "P1(T) Extraversion -> P2(T) Extraversion",
                              label == "indirecteffect" ~ "Mediated Effect"),
         label == fct_relevel(label,
                             "a",
                             "b",
                             "c"),
        pvalue = ifelse(pvalue >= .001, 
                        str_pad(str_replace(round(pvalue, 3),
                                            "0.", "."), 4, 
                                side = "right", pad ="0"),  
                        "< .001"),
        est = round(est, 2),
        est = ifelse(str_detect(est, "\\..$"), paste0(est, "0"), 
                   ifelse(str_detect(est, "^0$"), paste0(est, ".00"), est)),
        est = cell_spec(est, "html", 
                            bold = ifelse(abs(z) > 1.96, TRUE, FALSE)),
        ci_lower = round(ci_lower, 2),
        ci_lower = ifelse(str_detect(ci_lower, "\\..$"), paste0(ci_lower, "0"), 
                   ifelse(str_detect(ci_lower, "^0$"), paste0(ci_lower, ".00"), ci_lower)),
        ci_lower = cell_spec(ci_lower, "html", 
                            bold = ifelse(abs(z) > 1.96, TRUE, FALSE)),
        ci_upper = round(ci_upper, 2),
        ci_upper = ifelse(str_detect(ci_upper, "\\..$"), paste0(ci_upper, "0"), 
                   ifelse(str_detect(ci_upper, "^0$"), paste0(ci_upper, ".00"), ci_upper)),
        ci_upper = cell_spec(ci_upper, "html",
                            bold = ifelse(abs(z) > 1.96, TRUE, FALSE)),
        z = round(z, 2)) %>% 
  arrange(label) %>% 
  select(parameter, est, ci_lower, ci_upper, z, pvalue) %>% 
  distinct() %>% 
  knitr::kable(caption = "Extraversion and Leadership Mediation Results",
              format = "html", escape = F) %>% 
 kable_styling("striped", full_width = F) 
  
```


Our results are consistent with our hypothesis: P2's perception of the target's leadership is infleunced by their perception of the target's Extraversion, which is in turn influenced by P1's perception of the target's Extraversion.

### Additional Model: All Big Six and Leadership

```{r h3_all6_leadership_multi_med_model}
big6_status_multi_med_model_h3alt <-'
# Model for A-B-C triad
B_C_contextitem_goodleader ~ b1*B_C_extraversion + b2*B_C_agreeableness + b3*B_C_conscientiousness + b4*B_C_neuroticism + b5*B_C_openness + b6*B_C_hp + c1*A_C_extraversion + c2*A_C_agreeableness + c3*A_C_conscientiousness + c4*A_C_neuroticism + c5*A_C_openness + c6*A_C_hp 

B_C_extraversion      ~ a1*A_C_extraversion
B_C_agreeableness     ~ a2*A_C_agreeableness
B_C_conscientiousness ~ a3*A_C_conscientiousness
B_C_neuroticism       ~ a4*A_C_neuroticism
B_C_openness          ~ a5*A_C_openness
B_C_hp                ~ a6*A_C_hp

# Model for C-D-A triad
D_A_contextitem_goodleader ~ b1*D_A_extraversion + b2*D_A_agreeableness + b3*D_A_conscientiousness + b4*D_A_neuroticism + b5*D_A_openness + b6*D_A_hp + c1*C_A_extraversion + c2*C_A_agreeableness + c3*C_A_conscientiousness + c4*C_A_neuroticism + c5*C_A_openness + c6*C_A_hp 

D_A_extraversion      ~ a1*C_A_extraversion
D_A_agreeableness     ~ a2*C_A_agreeableness
D_A_conscientiousness ~ a3*C_A_conscientiousness
D_A_neuroticism       ~ a4*C_A_neuroticism
D_A_openness          ~ a5*C_A_openness
D_A_hp                ~ a6*C_A_hp

# variances
B_C_contextitem_goodleader ~~ v_P2_gl*B_C_contextitem_goodleader
D_A_contextitem_goodleader ~~ v_P2_gl*D_A_contextitem_goodleader
B_C_extraversion ~~ v_P2_ex*B_C_extraversion
D_A_extraversion ~~ v_P2_ex*D_A_extraversion
B_C_agreeableness ~~ v_P2_ag*B_C_agreeableness
D_A_agreeableness ~~ v_P2_ag*D_A_agreeableness
B_C_conscientiousness ~~ v_P2_co*B_C_conscientiousness
D_A_conscientiousness ~~ v_P2_co*D_A_conscientiousness
B_C_neuroticism ~~ v_P2_ne*B_C_neuroticism
D_A_neuroticism ~~ v_P2_ne*D_A_neuroticism
B_C_openness ~~ v_P2_op*B_C_openness
D_A_openness ~~ v_P2_op*D_A_openness
B_C_hp ~~ v_P2_hp*B_C_hp
D_A_hp ~~ v_P2_hp*D_A_hp

A_C_extraversion ~~ v_P1_ex*A_C_extraversion
C_A_extraversion ~~ v_P1_ex*C_A_extraversion
A_C_agreeableness ~~ v_P1_ag*A_C_agreeableness
C_A_agreeableness ~~ v_P1_ag*C_A_agreeableness
A_C_conscientiousness ~~ v_P1_co*A_C_conscientiousness
C_A_conscientiousness ~~ v_P1_co*C_A_conscientiousness
A_C_neuroticism ~~ v_P1_ne*A_C_neuroticism
C_A_neuroticism ~~ v_P1_ne*C_A_neuroticism
A_C_openness ~~ v_P1_op*A_C_openness
C_A_openness ~~ v_P1_op*C_A_openness
A_C_hp ~~ v_P1_hp*A_C_hp
C_A_hp ~~ v_P1_hp*C_A_hp


# intercepts

B_C_contextitem_goodleader ~ int_P2_gl*1
D_A_contextitem_goodleader ~ int_P2_gl*1
B_C_extraversion ~ int_P2_ex*1
D_A_extraversion ~ int_P2_ex*1
B_C_agreeableness ~ int_P2_ag*1
D_A_agreeableness ~ int_P2_ag*1
B_C_conscientiousness ~ int_P2_co*1
D_A_conscientiousness ~ int_P2_co*1
B_C_neuroticism ~ int_P2_ne*1
D_A_neuroticism ~ int_P2_ne*1
B_C_openness ~ int_P2_op*1
D_A_openness ~ int_P2_op*1
B_C_hp ~ int_P2_hp*1
D_A_hp ~ int_P2_hp*1

A_C_extraversion ~ int_P1_ex*1
C_A_extraversion ~ int_P1_ex*1
A_C_agreeableness ~ int_P1_ag*1
C_A_agreeableness ~ int_P1_ag*1
A_C_conscientiousness ~ int_P1_co*1
C_A_conscientiousness ~ int_P1_co*1
A_C_neuroticism ~ int_P1_ne*1
C_A_neuroticism ~ int_P1_ne*1
A_C_openness ~ int_P1_op*1
C_A_openness ~ int_P1_op*1
A_C_hp ~ int_P1_hp*1
C_A_hp ~ int_P1_hp*1


# indirect (mediated) effect
indirect_ex := a1*b1
indirect_ag := a2*b2
indirect_co := a3*b3
indirect_ne := a4*b4
indirect_op := a5*b5
indirect_hp := a6*b6
'
fit_big6_status_multi_med_model_h3alt <-sem(big6_status_multi_med_model_h3alt, 
                                            data = study2, 
                                            missing = "FIML", 
                                            se = "bootstrap", 
                                            fixed.x = TRUE)

summary(fit_big6_status_multi_med_model_h3alt)

```

#### Table for Big Six to Leadership Mediation model
```{r bigsix_leader_med_model_tbl}
parameterestimates(fit_big6_status_multi_med_model_h3alt) %>%
  as.data.frame() %>% 
  filter(str_detect(label, "^a") |
         str_detect(label, "^b") |
         str_detect(label, "^c") |
         str_detect(label, "^indirect_")) %>% 
  rename(ci_upper = ci.upper,
         ci_lower = ci.lower) %>% 
  mutate(parameter = case_when(
    label == "a1" ~ "P1(T) Extraversion -> P2(T) Extraversion",
    label == "a2" ~ "P1(T) Agreeableness -> P2(T) Agreeableness",
    label == "a3" ~ "P1(T) Conscientiousness -> P2(T) Conscientiousness",
    label == "a4" ~ "P1(T) Neuroticism -> P2(T) Neuroticism",
    label == "a5" ~ "P1(T) Openness -> P2(T) Openness",
    label == "a6" ~ "P1(T) Honesty-Propriety -> P2(T) Honesty-Propriety",
    label == "b1" ~ "P2(T) Extraversion -> P2(T) Leadership",
    label == "b2" ~ "P2(T) Agreeableness -> P2(T) Leadership",
    label == "b3" ~ "P2(T) Conscientiousness -> P2(T) Leadership",
    label == "b4" ~ "P2(T) Neuroticism -> P2(T) Leadership",
    label == "b5" ~ "P2(T) Openness -> P2(T) Leadership",
    label == "b6" ~ "P2(T) Honesty-Propriety -> P2(T) Leadership",
    label == "c1" ~ "P1(T) Extraversion -> P2(T) Leadership",
    label == "c2" ~ "P1(T) Agreeableness -> P2(T) Leadership",
    label == "c3" ~ "P1(T) Conscientiousness -> P2(T) Leadership",
    label == "c4" ~ "P1(T) Neuroticism -> P2(T) Leadership",
    label == "c5" ~ "P1(T) Openness -> P2(T) Leadership",
    label == "c6" ~ "P1(T) Honesty-Propriety -> P2(T) Leadership",
    label == "indirect_ex" ~ "Indirect Extraversion",
    label == "indirect_ag" ~ "Indirect Agreeableness",
    label == "indirect_co" ~ "Indirect Conscientiousness",
    label == "indirect_ne" ~ "Indirect Neuroticism",
    label == "indirect_op" ~ "Indirect Openness ",
    label == "indirect_hp" ~ "Indirect Honesty-Propriety"),
    label = fct_relevel(label,
                             "a1",
                             "a2",
                             "a3",
                             "a4",
                             "a5",
                             "a6",
                             "b1",
                             "b2",
                             "b3",
                             "b4",
                             "b5",
                             "b6",
                             "c1",
                             "c2",
                             "c3",
                             "c4",
                             "c5",
                             "c6",
                             "indirect_ex",
                             "indirect_ag",
                             "indirect_co",
                             "indirect_ne",
                             "indirect_op",
                             "indirect_hp"),
        pvalue = ifelse(pvalue >= .001, 
                        str_pad(str_replace(round(pvalue, 3),
                                            "0.", "."), 4, 
                                side = "right", pad ="0"),  
                        "< .001"),
        est = round(est, 2),
        est = ifelse(str_detect(est, "\\..$"), paste0(est, "0"), 
                   ifelse(str_detect(est, "^0$"), paste0(est, ".00"), est)),
        est = cell_spec(est, "html", 
                            bold = ifelse(abs(z) > 1.96, TRUE, FALSE)),
        ci_lower = round(ci_lower, 2),
        ci_lower = ifelse(str_detect(ci_lower, "\\..$"), paste0(ci_lower, "0"), 
                   ifelse(str_detect(ci_lower, "^0$"), paste0(ci_lower, ".00"), ci_lower)),
        ci_lower = cell_spec(ci_lower, "html", 
                            bold = ifelse(abs(z) > 1.96, TRUE, FALSE)),
        ci_upper = round(ci_upper, 2),
        ci_upper = ifelse(str_detect(ci_upper, "\\..$"), paste0(ci_upper, "0"), 
                   ifelse(str_detect(ci_upper, "^0$"), paste0(ci_upper, ".00"), ci_upper)),
        ci_upper = cell_spec(ci_upper, "html",
                            bold = ifelse(abs(z) > 1.96, TRUE, FALSE)),
        z = round(z, 2)) %>% 
  arrange(label) %>% 
  select(parameter, est, ci_lower, ci_upper, z, pvalue) %>% 
  distinct() %>% 
  knitr::kable(caption = "All Big Six and Leadership Mediation Results",
              format = "html", escape = F) %>% 
 kable_styling("striped", full_width = F) %>% 
 pack_rows("Hearsay Consensus Path", 1, 6) %>% 
 pack_rows("Hearsay Reputations of Big Six to Leadership", 7, 12) %>% 
 pack_rows("Direct Reputations of Big Six to Hearsay Reputations of Leadership", 13, 18) %>% 
 pack_rows("Indirect (Mediated) Effects", 19, 24)
```
Looks like the b paths (P2(T) trait -> P2(T) leadership) and the indirect effects are significant for Extraversion, Conscientiousness, and Openness. Suggests that P2's perception of T's leadership is determined by how Extraverted, Agreeable, and Conscientious they think T is, which in turn is affected by P1's perception of T on those dimensions.

## Effects of reputation on friendship judgments.

### Pre-Registered Mediation Model: Agreeableness to Friendship

This is a pre-registerd analysis looking at whether P1's perception of thr target's Agreeableness influences P2's perception of the target's Agreeableness, which in turn influences their perception of the target's friendship potential. It was pre-registered as hypothesis 4 on OSF.

```{r H4_path_model}
agreeableness_affil_med_model_h4 <-'
# Model for A-B-C triad
B_C_contextitem_goodfriend ~ b*B_C_agreeableness + c*A_C_agreeableness
B_C_agreeableness ~ a*A_C_agreeableness

# Model for C-D-A triad
D_A_contextitem_goodfriend ~ b*D_A_agreeableness + c*C_A_agreeableness
D_A_agreeableness ~ a*C_A_agreeableness

# variances
B_C_contextitem_goodfriend ~~ v_P2_gl*B_C_contextitem_goodfriend
D_A_contextitem_goodfriend ~~ v_P2_gl*D_A_contextitem_goodfriend
B_C_agreeableness ~~ v_P2*B_C_agreeableness
D_A_agreeableness ~~ v_P2*D_A_agreeableness
A_C_agreeableness ~~ v_P1*A_C_agreeableness
C_A_agreeableness ~~ v_P1*C_A_agreeableness

# intercepts
B_C_contextitem_goodfriend ~ int_P2_gl*1
D_A_contextitem_goodfriend ~ int_P2_gl*1
B_C_agreeableness ~ int_P2*1
D_A_agreeableness ~ int_P2*1
A_C_agreeableness ~ int_P1*1
C_A_agreeableness ~ int_P1*1

# indirect (mediated) effect
indirecteffect := a*b
'
fit_agreeableness_affil_med_model_h4 <-sem(agreeableness_affil_med_model_h4, 
                                            data = study2, 
                                            missing="FIML", 
                                            se="bootstrap", 
                                            fixed.x=TRUE)

summary(fit_agreeableness_affil_med_model_h4)
```

#### Table for Agreeableness to Friendship Mediation model
```{r agree_friendship_med_model_tbl}
parameterestimates(fit_agreeableness_affil_med_model_h4) %>%
  as.data.frame() %>% 
  filter(label == "a" |
         label == "b" |
         label == "c" |
         label == "indirecteffect") %>% 
  rename(ci_upper = ci.upper,
         ci_lower = ci.lower) %>% 
  mutate(parameter = case_when(label == "b" ~ "P2(T) Agreeableness -> P2(T) Friendship",
                              label == "c" ~ "P1(T) Agreeableness -> P2(T) Friendship",
                              label == "a" ~ "P1(T) Agreeableness -> P2(T) Agreeableness",
                              label == "indirecteffect" ~ "Mediated Effect"),
         label == fct_relevel(label,
                             "a",
                             "b",
                             "c"),
        pvalue = ifelse(pvalue >= .001, 
                        str_pad(str_replace(round(pvalue, 3),
                                            "0.", "."), 4, 
                                side = "right", pad ="0"),  
                        "< .001"),
        est = round(est, 2),
        est = ifelse(str_detect(est, "\\..$"), paste0(est, "0"), 
                   ifelse(str_detect(est, "^0$"), paste0(est, ".00"), est)),
        est = cell_spec(est, "html", 
                            bold = ifelse(abs(z) > 1.96, TRUE, FALSE)),
        ci_lower = round(ci_lower, 2),
        ci_lower = ifelse(str_detect(ci_lower, "\\..$"), paste0(ci_lower, "0"), 
                   ifelse(str_detect(ci_lower, "^0$"), paste0(ci_lower, ".00"), ci_lower)),
        ci_lower = cell_spec(ci_lower, "html", 
                            bold = ifelse(abs(z) > 1.96, TRUE, FALSE)),
        ci_upper = round(ci_upper, 2),
        ci_upper = ifelse(str_detect(ci_upper, "\\..$"), paste0(ci_upper, "0"), 
                   ifelse(str_detect(ci_upper, "^0$"), paste0(ci_upper, ".00"), ci_upper)),
        ci_upper = cell_spec(ci_upper, "html",
                            bold = ifelse(abs(z) > 1.96, TRUE, FALSE)),
        z = round(z, 2)) %>% 
  arrange(label) %>% 
  select(parameter, est, ci_lower, ci_upper, z, pvalue) %>% 
  distinct() %>% 
  knitr::kable(caption = "Agreeableness and Friendship Mediation Results",
              format = "html", escape = F) %>% 
 kable_styling("striped", full_width = F) 
  
```

Looks like our results are consistent with our hypothesis: P2's perception of the target's friendship is infleunced by their perception of the target's Agreeableness, which is in turn influenced by P1's perception of the target's Agreeableness.

### Alternative Model : All Big Six and Friendship

```{r h3_all6_friendship_multi_med_model}
big6_affil_multi_med_model_h3alt <-'
# Model for A-B-C triad
B_C_contextitem_goodfriend ~ b1*B_C_extraversion + b2*B_C_agreeableness + b3*B_C_conscientiousness + b4*B_C_neuroticism + b5*B_C_openness + b6*B_C_hp + c1*A_C_extraversion + c2*A_C_agreeableness + c3*A_C_conscientiousness + c4*A_C_neuroticism + c5*A_C_openness + c6*A_C_hp 

B_C_extraversion      ~ a1*A_C_extraversion
B_C_agreeableness     ~ a2*A_C_agreeableness
B_C_conscientiousness ~ a3*A_C_conscientiousness
B_C_neuroticism       ~ a4*A_C_neuroticism
B_C_openness          ~ a5*A_C_openness
B_C_hp                ~ a6*A_C_hp

# Model for C-D-A triad
D_A_contextitem_goodfriend ~ b1*D_A_extraversion + b2*D_A_agreeableness + b3*D_A_conscientiousness + b4*D_A_neuroticism + b5*D_A_openness + b6*D_A_hp + c1*C_A_extraversion + c2*C_A_agreeableness + c3*C_A_conscientiousness + c4*C_A_neuroticism + c5*C_A_openness + c6*C_A_hp 

D_A_extraversion      ~ a1*C_A_extraversion
D_A_agreeableness     ~ a2*C_A_agreeableness
D_A_conscientiousness ~ a3*C_A_conscientiousness
D_A_neuroticism       ~ a4*C_A_neuroticism
D_A_openness          ~ a5*C_A_openness
D_A_hp                ~ a6*C_A_hp

# variances
B_C_contextitem_goodfriend ~~ v_P2_gf*B_C_contextitem_goodfriend
D_A_contextitem_goodfriend ~~ v_P2_gf*D_A_contextitem_goodfriend
B_C_extraversion ~~ v_P2_ex*B_C_extraversion
D_A_extraversion ~~ v_P2_ex*D_A_extraversion
B_C_agreeableness ~~ v_P2_ag*B_C_agreeableness
D_A_agreeableness ~~ v_P2_ag*D_A_agreeableness
B_C_conscientiousness ~~ v_P2_co*B_C_conscientiousness
D_A_conscientiousness ~~ v_P2_co*D_A_conscientiousness
B_C_neuroticism ~~ v_P2_ne*B_C_neuroticism
D_A_neuroticism ~~ v_P2_ne*D_A_neuroticism
B_C_openness ~~ v_P2_op*B_C_openness
D_A_openness ~~ v_P2_op*D_A_openness
B_C_hp ~~ v_P2_hp*B_C_hp
D_A_hp ~~ v_P2_hp*D_A_hp

A_C_extraversion ~~ v_P1_ex*A_C_extraversion
C_A_extraversion ~~ v_P1_ex*C_A_extraversion
A_C_agreeableness ~~ v_P1_ag*A_C_agreeableness
C_A_agreeableness ~~ v_P1_ag*C_A_agreeableness
A_C_conscientiousness ~~ v_P1_co*A_C_conscientiousness
C_A_conscientiousness ~~ v_P1_co*C_A_conscientiousness
A_C_neuroticism ~~ v_P1_ne*A_C_neuroticism
C_A_neuroticism ~~ v_P1_ne*C_A_neuroticism
A_C_openness ~~ v_P1_op*A_C_openness
C_A_openness ~~ v_P1_op*C_A_openness
A_C_hp ~~ v_P1_hp*A_C_hp
C_A_hp ~~ v_P1_hp*C_A_hp


# intercepts

B_C_contextitem_goodfriend ~ int_P2_gf*1
D_A_contextitem_goodfriend ~ int_P2_gf*1
B_C_extraversion ~ int_P2_ex*1
D_A_extraversion ~ int_P2_ex*1
B_C_agreeableness ~ int_P2_ag*1
D_A_agreeableness ~ int_P2_ag*1
B_C_conscientiousness ~ int_P2_co*1
D_A_conscientiousness ~ int_P2_co*1
B_C_neuroticism ~ int_P2_ne*1
D_A_neuroticism ~ int_P2_ne*1
B_C_openness ~ int_P2_op*1
D_A_openness ~ int_P2_op*1
B_C_hp ~ int_P2_hp*1
D_A_hp ~ int_P2_hp*1

A_C_extraversion ~ int_P1_ex*1
C_A_extraversion ~ int_P1_ex*1
A_C_agreeableness ~ int_P1_ag*1
C_A_agreeableness ~ int_P1_ag*1
A_C_conscientiousness ~ int_P1_co*1
C_A_conscientiousness ~ int_P1_co*1
A_C_neuroticism ~ int_P1_ne*1
C_A_neuroticism ~ int_P1_ne*1
A_C_openness ~ int_P1_op*1
C_A_openness ~ int_P1_op*1
A_C_hp ~ int_P1_hp*1
C_A_hp ~ int_P1_hp*1


# indirect (mediated) effect
indirect_ex := a1*b1
indirect_ag := a2*b2
indirect_co := a3*b3
indirect_ne := a4*b4
indirect_op := a5*b5
indirect_hp := a6*b6
'
fit_big6_affil_multi_med_model_h3alt <-sem(big6_affil_multi_med_model_h3alt, 
                                            data = study2, 
                                            missing = "FIML", 
                                            se = "bootstrap", 
                                            fixed.x = TRUE)

summary(fit_big6_affil_multi_med_model_h3alt)
```

#### Table for Big Six to Friendship Mediation model
```{r bigsix_friend_med_model_tbl}
parameterestimates(fit_big6_affil_multi_med_model_h3alt) %>%
  as.data.frame() %>% 
  filter(str_detect(label, "^a") |
         str_detect(label, "^b") |
         str_detect(label, "^c") |
         str_detect(label, "^indirect_")) %>% 
  rename(ci_upper = ci.upper,
         ci_lower = ci.lower) %>% 
  mutate(parameter = case_when(
    label == "a1" ~ "P1(T) Extraversion -> P2(T) Extraversion",
    label == "a2" ~ "P1(T) Agreeableness -> P2(T) Agreeableness",
    label == "a3" ~ "P1(T) Conscientiousness -> P2(T) Conscientiousness",
    label == "a4" ~ "P1(T) Neuroticism -> P2(T) Neuroticism",
    label == "a5" ~ "P1(T) Openness -> P2(T) Openness",
    label == "a6" ~ "P1(T) Honesty-Propriety -> P2(T) Honesty-Propriety",
    label == "b1" ~ "P2(T) Extraversion -> P2(T) Friendship",
    label == "b2" ~ "P2(T) Agreeableness -> P2(T) Friendship",
    label == "b3" ~ "P2(T) Conscientiousness -> P2(T) Friendship",
    label == "b4" ~ "P2(T) Neuroticism -> P2(T) Friendship",
    label == "b5" ~ "P2(T) Openness -> P2(T) Friendship",
    label == "b6" ~ "P2(T) Honesty-Propriety -> P2(T) Friendship",
    label == "c1" ~ "P1(T) Extraversion -> P2(T) Friendship",
    label == "c2" ~ "P1(T) Agreeableness -> P2(T) Friendship",
    label == "c3" ~ "P1(T) Conscientiousness -> P2(T) Friendship",
    label == "c4" ~ "P1(T) Neuroticism -> P2(T) Friendship",
    label == "c5" ~ "P1(T) Openness -> P2(T) Friendship",
    label == "c6" ~ "P1(T) Honesty-Propriety -> P2(T) Friendship",
    label == "indirect_ex" ~ "Indirect Extraversion",
    label == "indirect_ag" ~ "Indirect Agreeableness",
    label == "indirect_co" ~ "Indirect Conscientiousness",
    label == "indirect_ne" ~ "Indirect Neuroticism",
    label == "indirect_op" ~ "Indirect Openness ",
    label == "indirect_hp" ~ "Indirect Honesty-Propriety"),
    label = fct_relevel(label,
                             "a1",
                             "a2",
                             "a3",
                             "a4",
                             "a5",
                             "a6",
                             "b1",
                             "b2",
                             "b3",
                             "b4",
                             "b5",
                             "b6",
                             "c1",
                             "c2",
                             "c3",
                             "c4",
                             "c5",
                             "c6",
                             "indirect_ex",
                             "indirect_ag",
                             "indirect_co",
                             "indirect_ne",
                             "indirect_op",
                             "indirect_hp"),
        pvalue = ifelse(pvalue >= .001, 
                        str_pad(str_replace(round(pvalue, 3),
                                            "0.", "."), 4, 
                                side = "right", pad ="0"),  
                        "< .001"),
        est = round(est, 2),
        est = ifelse(str_detect(est, "\\..$"), paste0(est, "0"), 
                   ifelse(str_detect(est, "^0$"), paste0(est, ".00"), est)),
        est = cell_spec(est, "html", 
                            bold = ifelse(abs(z) > 1.96, TRUE, FALSE)),
        ci_lower = round(ci_lower, 2),
        ci_lower = ifelse(str_detect(ci_lower, "\\..$"), paste0(ci_lower, "0"), 
                   ifelse(str_detect(ci_lower, "^0$"), paste0(ci_lower, ".00"), ci_lower)),
        ci_lower = cell_spec(ci_lower, "html", 
                            bold = ifelse(abs(z) > 1.96, TRUE, FALSE)),
        ci_upper = round(ci_upper, 2),
        ci_upper = ifelse(str_detect(ci_upper, "\\..$"), paste0(ci_upper, "0"), 
                   ifelse(str_detect(ci_upper, "^0$"), paste0(ci_upper, ".00"), ci_upper)),
        ci_upper = cell_spec(ci_upper, "html",
                            bold = ifelse(abs(z) > 1.96, TRUE, FALSE)),
        z = round(z, 2)) %>% 
  arrange(label) %>% 
  select(parameter, est, ci_lower, ci_upper, z, pvalue) %>% 
  distinct() %>% 
  knitr::kable(caption = "All Big Six and Friendship Mediation Results",
              format = "html", escape = F) %>% 
 kable_styling("striped", full_width = F) %>% 
 pack_rows("Hearsay Consensus Path", 1, 6) %>% 
 pack_rows("Hearsay Reputations of Big Six to Friendship", 7, 12) %>% 
 pack_rows("Direct Reputations of Big Six to Hearsay Reputations of Friendship", 13, 18) %>% 
 pack_rows("Indirect (Mediated) Effects", 19, 24)
```

Looks like the b path (P2(T) trait -> P2(T) friendship) and indirect effect are only significant for Agreeableness; the remaining Big Six did not have a significant b path or indirect effect (Openness was close, but no cigar). Suggests that P2's perception of T's friendship is determined by how Agreeable they think T is, which in turn is affected by P1's perception of T's Agreeableness. 

